
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>plot.py &#8212; Streamlines  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="save.py" href="save.html" />
    <link rel="prev" title="mapping.py" href="mapping.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-streamlines.plot">
<span id="plot-py"></span><h1><code class="docutils literal notranslate"><span class="pre">plot.py</span></code><a class="headerlink" href="#module-streamlines.plot" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>Module for map and graph plotting.</p>
<hr class="docutils" />
<dl class="docutils">
<dt>Requires Python packages/modules:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://docs.python.org/3/library/random.html#module-random" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">random</span></code></a></li>
<li><a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.html#module-matplotlib.pyplot" title="(in Matplotlib v3.0.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code></a></li>
<li><a class="reference external" href="https://matplotlib.org/api/gridspec_api.html#module-matplotlib.gridspec" title="(in Matplotlib v3.0.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">matplotlib.gridspec</span></code></a></li>
<li><a class="reference external" href="https://matplotlib.org/api/ticker_api.html#module-matplotlib.ticker" title="(in Matplotlib v3.0.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">matplotlib.ticker</span></code></a></li>
<li><a class="reference external" href="https://matplotlib.org/api/colors_api.html#module-matplotlib.colors" title="(in Matplotlib v3.0.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">matplotlib.colors</span></code></a></li>
<li><a class="reference external" href="https://matplotlib.org/api/patches_api.html#module-matplotlib.patches" title="(in Matplotlib v3.0.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">matplotlib.patches</span></code></a></li>
<li><a class="reference external" href="https://matplotlib.org/api/_as_gen/mpl_toolkits.axes_grid1.axes_divider.html#module-mpl_toolkits.axes_grid1.axes_divider" title="(in Matplotlib v3.0.2)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mpl_toolkits.axes_grid1</span></code></a></li>
<li><a class="reference external" href="https://docs.python.org/3/library/colorsys.html#module-colorsys" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">colorsys</span></code></a></li>
<li><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/interpolate.html#module-scipy.interpolate" title="(in SciPy v1.1.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.interpolate</span></code></a></li>
<li><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/stats.html#module-scipy.stats" title="(in SciPy v1.1.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.stats</span></code></a></li>
<li><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/signal.html#module-scipy.signal" title="(in SciPy v1.1.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scipy.signal</span></code></a></li>
</ul>
</dd>
</dl>
<p>Imports <a class="reference internal" href="core.html#streamlines.core.Core" title="streamlines.core.Core"><code class="xref py py-class docutils literal notranslate"><span class="pre">Core</span></code></a> class.</p>
<hr class="docutils" />
<dl class="class">
<dt id="streamlines.plot.Plot">
<em class="property">class </em><code class="descclassname">streamlines.plot.</code><code class="descname">Plot</code><span class="sig-paren">(</span><em>state</em>, <em>imported_parameters</em>, <em>geodata</em>, <em>preprocess</em>, <em>trace</em>, <em>analysis</em>, <em>mapping</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot maps and distributions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="streamlines.plot.Plot.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>state</em>, <em>imported_parameters</em>, <em>geodata</em>, <em>preprocess</em>, <em>trace</em>, <em>analysis</em>, <em>mapping</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.__init__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot._force_display">
<code class="descname">_force_display</code><span class="sig-paren">(</span><em>fig</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot._force_display" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot._new_figure">
<code class="descname">_new_figure</code><span class="sig-paren">(</span><em>title=None</em>, <em>window_title=None</em>, <em>pdf=False</em>, <em>x_pixel_scale=1</em>, <em>y_pixel_scale=1</em>, <em>window_size_factor=None</em>, <em>projection=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot._new_figure" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot._record_fig">
<code class="descname">_record_fig</code><span class="sig-paren">(</span><em>fig_name</em>, <em>fig</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot._record_fig" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.do">
<code class="descname">do</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.do" title="Permalink to this definition">¶</a></dt>
<dd><p>Display all output</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="streamlines.plot.Plot.generate_hillshade">
<em class="property">static </em><code class="descname">generate_hillshade</code><span class="sig-paren">(</span><em>azimuth_degrees</em>, <em>angle_altitude_degrees</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.generate_hillshade" title="Permalink to this definition">¶</a></dt>
<dd><p>Hillshade render DTM topo with light from direction azimuth_degrees and tilt
angle_attitude_degrees</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_aspect">
<code class="descname">plot_aspect</code><span class="sig-paren">(</span><em>window_size_factor=None</em>, <em>cmap=None</em>, <em>do_plot_contours=None</em>, <em>contour_label_suffix=None</em>, <em>contour_label_fontsize=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_aspect" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_blockages_overlay">
<code class="descname">plot_blockages_overlay</code><span class="sig-paren">(</span><em>axes</em>, <em>color='k'</em>, <em>shape='s'</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_blockages_overlay" title="Permalink to this definition">¶</a></dt>
<dd><p>Blocked zone pixels</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_channels">
<code class="descname">plot_channels</code><span class="sig-paren">(</span><em>window_size_factor=None</em>, <em>do_reset_mask=True</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_channels" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_classical_streamlines">
<code class="descname">plot_classical_streamlines</code><span class="sig-paren">(</span><em>window_size_factor=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_classical_streamlines" title="Permalink to this definition">¶</a></dt>
<dd><p>Classic streamlines on color shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_classical_streamlines_and_vectors">
<code class="descname">plot_classical_streamlines_and_vectors</code><span class="sig-paren">(</span><em>window_size_factor=None</em>, <em>sl_color=None</em>, <em>vec_color=None</em>, <em>vec_alpha=None</em>, <em>vec_scale=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_classical_streamlines_and_vectors" title="Permalink to this definition">¶</a></dt>
<dd><p>Classic streamlines and gradient vector field on color shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_classical_streamlines_overlay">
<code class="descname">plot_classical_streamlines_overlay</code><span class="sig-paren">(</span><em>axes</em>, <em>sl_color='blue'</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_classical_streamlines_overlay" title="Permalink to this definition">¶</a></dt>
<dd><p>Classic streamlines (overlay method)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_compound_markers">
<code class="descname">plot_compound_markers</code><span class="sig-paren">(</span><em>axes</em>, <em>flag</em>, <em>colors</em>, <em>msf=1.0</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_compound_markers" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_contours_overlay">
<code class="descname">plot_contours_overlay</code><span class="sig-paren">(</span><em>axes</em>, <em>Z</em>, <em>mask=None</em>, <em>n_contours=None</em>, <em>contour_interval=None</em>, <em>linewidth=None</em>, <em>contour_label_suffix='m'</em>, <em>contour_label_fontsize=12</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_contours_overlay" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_distributions">
<code class="descname">plot_distributions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_distributions" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot probability distributions of processed streamline data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_dtm_shaded_relief">
<code class="descname">plot_dtm_shaded_relief</code><span class="sig-paren">(</span><em>window_size_factor=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_dtm_shaded_relief" title="Permalink to this definition">¶</a></dt>
<dd><p>Hillshade view of source DTM</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_flow_maps">
<code class="descname">plot_flow_maps</code><span class="sig-paren">(</span><em>window_size_factor=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_flow_maps" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_gradient_vector_field">
<code class="descname">plot_gradient_vector_field</code><span class="sig-paren">(</span><em>window_size_factor=None</em>, <em>vec_color='purple'</em>, <em>vec_alpha=0.5</em>, <em>vec_scale=30</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_gradient_vector_field" title="Permalink to this definition">¶</a></dt>
<dd><p>Topographic gradient vector field on color shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_gradient_vector_field_overlay">
<code class="descname">plot_gradient_vector_field_overlay</code><span class="sig-paren">(</span><em>axes</em>, <em>vec_color='purple'</em>, <em>vec_alpha=0.5</em>, <em>vec_scale=30</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_gradient_vector_field_overlay" title="Permalink to this definition">¶</a></dt>
<dd><p>Topographic gradient vector field (overlay method)</p>
<blockquote>
<div><dl class="docutils">
<dt>Args:</dt>
<dd>TBD (TBD):</dd>
</dl>
<p>TBD</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>TBD:
TBD</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_gridded_data">
<code class="descname">plot_gridded_data</code><span class="sig-paren">(</span><em>grid_array</em>, <em>gridded_cmap</em>, <em>window_size_factor=None</em>, <em>fig_name=None</em>, <em>mask_array=None</em>, <em>window_title=''</em>, <em>do_flip_cmap=False</em>, <em>do_balance_cmap=True</em>, <em>do_shaded_relief=True</em>, <em>do_colorbar=False</em>, <em>colorbar_title=None</em>, <em>colorbar_aspect=0.07</em>, <em>colorbar_size=4</em>, <em>grid_alpha=None</em>, <em>extent=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_gridded_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_hsl">
<code class="descname">plot_hsl</code><span class="sig-paren">(</span><em>cmap=None</em>, <em>window_size_factor=None</em>, <em>z_min=None</em>, <em>z_max=None</em>, <em>z_pctile=None</em>, <em>do_shaded_relief=None</em>, <em>colorbar_size=None</em>, <em>colorbar_aspect=None</em>, <em>grid_alpha=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_hsl" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_hsl_aspect_distribution">
<code class="descname">plot_hsl_aspect_distribution</code><span class="sig-paren">(</span><em>window_size_factor=None</em>, <em>cmap=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_hsl_aspect_distribution" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_hsl_contoured">
<code class="descname">plot_hsl_contoured</code><span class="sig-paren">(</span><em>window_size_factor=None</em>, <em>cmap=None</em>, <em>do_colorbar=True</em>, <em>colorbar_title='hillslope length [m]'</em>, <em>n_contours=None</em>, <em>contour_interval=None</em>, <em>linewidth=None</em>, <em>z_min=None</em>, <em>z_max=None</em>, <em>z_pctile=None</em>, <em>do_shaded_relief=None</em>, <em>colorbar_size=None</em>, <em>colorbar_aspect=None</em>, <em>contour_label_suffix=None</em>, <em>contour_label_fontsize=None</em>, <em>do_plot_contours=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_hsl_contoured" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_hsl_distributions">
<code class="descname">plot_hsl_distributions</code><span class="sig-paren">(</span><em>x_stretch=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_hsl_distributions" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_joint_pdf">
<code class="descname">plot_joint_pdf</code><span class="sig-paren">(</span><em>bivariate_distribution</em>, <em>mx_distbn=None</em>, <em>my_distbn=None</em>, <em>fig_name=None</em>, <em>title=''</em>, <em>swap_xy=False</em>, <em>do_nl_trend=False</em>, <em>x_label=''</em>, <em>y_label=''</em>, <em>xsym_label='$L_m^{*}$'</em>, <em>ysym_label='$\\sqrt{A_e^*}$'</em>, <em>do_plot_mode=True</em>, <em>do_overlay_histogram=False</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_joint_pdf" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_joint_pdf_dsla_dslc">
<code class="descname">plot_joint_pdf_dsla_dslc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_joint_pdf_dsla_dslc" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_joint_pdf_dsla_dslt">
<code class="descname">plot_joint_pdf_dsla_dslt</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_joint_pdf_dsla_dslt" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_joint_pdf_dsla_usla">
<code class="descname">plot_joint_pdf_dsla_usla</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_joint_pdf_dsla_usla" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_joint_pdf_dslt_dsla">
<code class="descname">plot_joint_pdf_dslt_dsla</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_joint_pdf_dslt_dsla" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_joint_pdf_dslt_dslc">
<code class="descname">plot_joint_pdf_dslt_dslc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_joint_pdf_dslt_dslc" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_joint_pdf_usla_uslc">
<code class="descname">plot_joint_pdf_usla_uslc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_joint_pdf_usla_uslc" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_joint_pdf_usla_uslt">
<code class="descname">plot_joint_pdf_usla_uslt</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_joint_pdf_usla_uslt" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_joint_pdf_uslc_dslc">
<code class="descname">plot_joint_pdf_uslc_dslc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_joint_pdf_uslc_dslc" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_joint_pdf_uslt_dslt">
<code class="descname">plot_joint_pdf_uslt_dslt</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_joint_pdf_uslt_dslt" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_loops_overlay">
<code class="descname">plot_loops_overlay</code><span class="sig-paren">(</span><em>axes</em>, <em>color='k'</em>, <em>shape='o'</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_loops_overlay" title="Permalink to this definition">¶</a></dt>
<dd><p>Loop zone pixels</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_maps">
<code class="descname">plot_maps</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_maps" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot maps</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_marginal_pdf">
<code class="descname">plot_marginal_pdf</code><span class="sig-paren">(</span><em>marginal_distbn</em>, <em>fig_name=None</em>, <em>title=''</em>, <em>x_label=''</em>, <em>y_label=''</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_marginal_pdf" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_marginal_pdf_dsla">
<code class="descname">plot_marginal_pdf_dsla</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_marginal_pdf_dsla" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_marginal_pdf_dslc">
<code class="descname">plot_marginal_pdf_dslc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_marginal_pdf_dslc" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_marginal_pdf_dslt">
<code class="descname">plot_marginal_pdf_dslt</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_marginal_pdf_dslt" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_marginal_pdf_usla">
<code class="descname">plot_marginal_pdf_usla</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_marginal_pdf_usla" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_marginal_pdf_uslc">
<code class="descname">plot_marginal_pdf_uslc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_marginal_pdf_uslc" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_marginal_pdf_uslt">
<code class="descname">plot_marginal_pdf_uslt</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_marginal_pdf_uslt" title="Permalink to this definition">¶</a></dt>
<dd><p>TBD</p>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_midslope_elevations_pdf">
<code class="descname">plot_midslope_elevations_pdf</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_midslope_elevations_pdf" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot distribution of midslope as kernel-smoothed pdf</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_roi_shaded_relief">
<code class="descname">plot_roi_shaded_relief</code><span class="sig-paren">(</span><em>interp_method=None</em>, <em>window_size_factor=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_roi_shaded_relief" title="Permalink to this definition">¶</a></dt>
<dd><p>Hillshade view of ROI of DTM</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_roi_shaded_relief_overlay">
<code class="descname">plot_roi_shaded_relief_overlay</code><span class="sig-paren">(</span><em>axes</em>, <em>do_plot_color_relief=None</em>, <em>color_alpha=None</em>, <em>hillshade_alpha=None</em>, <em>interp_method=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_roi_shaded_relief_overlay" title="Permalink to this definition">¶</a></dt>
<dd><p>Hillshade view of ROI of DTM (overlay method)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_seed_points_overlay">
<code class="descname">plot_seed_points_overlay</code><span class="sig-paren">(</span><em>axes</em>, <em>color='k'</em>, <em>marker='</em>, <em>'</em>, <em>size=2</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_seed_points_overlay" title="Permalink to this definition">¶</a></dt>
<dd><p>Seed points</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_segments">
<code class="descname">plot_segments</code><span class="sig-paren">(</span><em>do_shaded_relief=True</em>, <em>window_size_factor=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_segments" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_simple_grid">
<code class="descname">plot_simple_grid</code><span class="sig-paren">(</span><em>grid_array</em>, <em>mask_array</em>, <em>axes</em>, <em>cmap='Blues'</em>, <em>alpha=0.8</em>, <em>do_vlimit=True</em>, <em>v_min=None</em>, <em>v_max=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_simple_grid" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_slope_angles_pdf">
<code class="descname">plot_slope_angles_pdf</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_slope_angles_pdf" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot distribution of slope angles as kernel-smoothed pdf</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_streamlines">
<code class="descname">plot_streamlines</code><span class="sig-paren">(</span><em>window_size_factor=None</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_streamlines" title="Permalink to this definition">¶</a></dt>
<dd><p>Streamlines, points on semi-transparent shaded relief</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="streamlines.plot.Plot.plot_updownstreamlines_overlay">
<code class="descname">plot_updownstreamlines_overlay</code><span class="sig-paren">(</span><em>axes</em>, <em>do_down=True</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.plot_updownstreamlines_overlay" title="Permalink to this definition">¶</a></dt>
<dd><p>Up or downstreamlines</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="streamlines.plot.Plot.show">
<em class="property">static </em><code class="descname">show</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.Plot.show" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="streamlines.plot.random_colormap">
<code class="descclassname">streamlines.plot.</code><code class="descname">random_colormap</code><span class="sig-paren">(</span><em>cmap_name='randomized'</em>, <em>n_colors=1000</em>, <em>random_seed=1</em><span class="sig-paren">)</span><a class="headerlink" href="#streamlines.plot.random_colormap" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a cmap with a randomized sequence of bright colors</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>TBD</strong> (<em>TBD</em>) – </td>
</tr>
</tbody>
</table>
<p>TBD</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">TBD</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">TBD</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">---------------------------------------------------------------------</span>

<span class="sd">Module for map and graph plotting.</span>

<span class="sd">---------------------------------------------------------------------</span>

<span class="sd">Requires Python packages/modules:</span>
<span class="sd">  -  :mod:`random`</span>
<span class="sd">  -  :mod:`matplotlib.pyplot`</span>
<span class="sd">  -  :mod:`matplotlib.gridspec`</span>
<span class="sd">  -  :mod:`matplotlib.ticker`</span>
<span class="sd">  -  :mod:`matplotlib.colors`</span>
<span class="sd">  -  :mod:`matplotlib.patches`</span>
<span class="sd">  -  :mod:`mpl_toolkits.axes_grid1 &lt;mpl_toolkits.axes_grid1.axes_divider&gt;`</span>
<span class="sd">  -  :mod:`colorsys`</span>
<span class="sd">  -  :mod:`scipy.interpolate`</span>
<span class="sd">  -  :mod:`scipy.stats`</span>
<span class="sd">  -  :mod:`scipy.signal`</span>

<span class="sd">Imports :class:`.Core` class.</span>

<span class="sd">---------------------------------------------------------------------</span>

<span class="sd">.. _matplotlib: https://matplotlib.org/</span>
<span class="sd">.. _scipy: https://www.scipy.org/</span>
<span class="sd">.. _random: https://docs.python.org/3/library/random.html</span>
<span class="sd">.. _mpl_toolkits: https://matplotlib.org/mpl_toolkits/index.html</span>
<span class="sd">.. _colorsys: https://docs.python.org/3/library/colorsys.html</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Notes on potentially useful mpl:</span>
<span class="c1">#  plt.style.use(&#39;classic&#39;)</span>
<span class="c1">#  axes[0].axhline,axes[0].axvline</span>
<span class="c1">#  data=data obj dict</span>
<span class="c1">#  cax=fig.add_axes to add custom color bar; cax=cax in fig.colorbar</span>
<span class="c1">#  color map range: vmin, vmax; also norm</span>
<span class="c1">#  Use fig, (axes1,axes2) =  to access multiple axes </span>
<span class="c1">#  CartoPy</span>
<span class="c1">#  mpl_toolkits.axes_grid1</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span>   <span class="nn">numpy</span>  <span class="k">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">arctan</span><span class="p">,</span> <span class="n">arctan2</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sqrt</span>
<span class="kn">from</span>   <span class="nn">random</span> <span class="k">import</span> <span class="n">shuffle</span><span class="p">,</span> <span class="n">seed</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>   <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span>   <span class="k">as</span> <span class="nn">ticker</span>
<span class="kn">from</span>   <span class="nn">matplotlib.pyplot</span>   <span class="k">import</span> <span class="n">streamplot</span>
<span class="kn">from</span>   <span class="nn">matplotlib.colors</span>   <span class="k">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">from</span>   <span class="nn">matplotlib.patches</span>  <span class="k">import</span> <span class="n">ArrowStyle</span><span class="p">,</span> <span class="n">FancyArrowPatch</span>
<span class="kn">from</span>   <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>
<span class="c1"># from   mpl_toolkits.axes_grid1.axes_divider import make_axes_locatable</span>
<span class="kn">import</span> <span class="nn">colorsys</span>
<span class="kn">from</span>   <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span> 
<span class="kn">from</span>   <span class="nn">scipy.signal</span>      <span class="k">import</span> <span class="n">decimate</span>
<span class="kn">from</span>   <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="k">import</span> <span class="n">binary_dilation</span><span class="p">,</span> <span class="n">generate_binary_structure</span>
                                     
<span class="kn">from</span>   <span class="nn">os</span> <span class="k">import</span> <span class="n">environ</span>
<span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYTHONUNBUFFERED&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;True&#39;</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Qt5Agg&#39;</span><span class="p">);</span>  <span class="c1"># Worth trying?</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="kn">from</span> <span class="nn">streamlines.core</span> <span class="k">import</span> <span class="n">Core</span>

<span class="n">pdebug</span> <span class="o">=</span> <span class="nb">print</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Plot&#39;</span><span class="p">,</span> <span class="s1">&#39;random_colormap&#39;</span><span class="p">]</span>
    
<span class="c1"># Generate random colormap</span>
<span class="k">def</span> <span class="nf">random_colormap</span><span class="p">(</span><span class="n">cmap_name</span><span class="o">=</span><span class="s1">&#39;randomized&#39;</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">random_seed</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a cmap with a randomized sequence of bright colors</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        TBD (TBD): </span>
<span class="sd">    </span>
<span class="sd">    TBD</span>

<span class="sd">    Returns:</span>
<span class="sd">        TBD: </span>
<span class="sd">        TBD</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ru</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
    <span class="n">color_palette</span> \
        <span class="o">=</span> <span class="p">[</span><span class="n">colorsys</span><span class="o">.</span><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">ru</span><span class="p">(),</span><span class="n">ru</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span><span class="n">ru</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.9</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">cmap_name</span><span class="p">,</span> <span class="n">color_palette</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">n_colors</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Plot</span><span class="p">(</span><span class="n">Core</span><span class="p">):</span>       
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot maps and distributions.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        TBD (TBD): </span>
<span class="sd">    </span>
<span class="sd">    TBD</span>

<span class="sd">    Returns:</span>
<span class="sd">        TBD: </span>
<span class="sd">        TBD</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">imported_parameters</span><span class="p">,</span>
                 <span class="n">geodata</span><span class="p">,</span> <span class="n">preprocess</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">analysis</span><span class="p">,</span> <span class="n">mapping</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="n">imported_parameters</span><span class="p">)</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span> <span class="o">=</span> <span class="n">geodata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span> <span class="o">=</span> <span class="n">preprocess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">trace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span> <span class="o">=</span> <span class="n">analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figs</span> <span class="o">=</span> <span class="p">{}</span>
        
    <span class="k">def</span> <span class="nf">_new_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pdf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                    <span class="n">x_pixel_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">y_pixel_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c1">#         mpl.rc( &#39;savefig&#39;, dpi=300)</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span> <span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">autolayout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="n">titlesize</span><span class="o">=</span><span class="s1">&#39;Large&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dpi</span><span class="p">)</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span> <span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># mpl.rc( &#39;font&#39;, size=14,family=&#39;Times New Roman&#39;, serif=&#39;cm&#39;)</span>
        <span class="c1"># mpl.rc( &#39;font&#39;, size=14,family=&#39;DejaVu Sans&#39;, serif=&#39;cm&#39;)</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span> <span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">general_font_size</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span> <span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axes_font_size</span><span class="p">)</span> 
        <span class="c1"># mpl.rc( &#39;legend&#39;, fontsize=10)</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">title</span>
        <span class="k">if</span> <span class="n">window_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">window_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameters_file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure_count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pdf</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">window_size_factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">window_size_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size_factor</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">window_size_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_pdf_size_factor</span>
        
        <span class="k">if</span> <span class="n">projection</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span> 
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_width</span> <span class="o">*</span><span class="n">window_size_factor</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">window_height</span><span class="o">*</span><span class="n">window_size_factor</span><span class="p">))</span>
            <span class="n">ticks_x</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{0:g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x_pixel_scale</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticks_x</span><span class="p">)</span>
            <span class="n">ticks_y</span> <span class="o">=</span> <span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{0:g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">y_pixel_scale</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticks_y</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">projection</span><span class="o">==</span><span class="s1">&#39;polar&#39;</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span> 
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_width</span> <span class="o">*</span><span class="n">window_size_factor</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">window_height</span><span class="o">*</span><span class="n">window_size_factor</span><span class="p">),</span>
                            <span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Projection not understood&#39;</span><span class="p">)</span> 

        <span class="n">axes</span><span class="o">.</span><span class="n">set_rasterization_zorder</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="n">window_title</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title_font_size</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>
          
    <span class="k">def</span> <span class="nf">_record_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Recording figure &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fig_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">fig_name</span> <span class="p">:</span> <span class="n">fig</span><span class="p">})</span>  
        <span class="k">return</span> <span class="n">fig_name</span>     

    <span class="k">def</span> <span class="nf">_force_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">do_display</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
                <span class="c1"># this makes sure that the gui window gets shown</span>
                <span class="c1"># if this is needed depends on rcparams, this is just to be safe</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">flush_events</span><span class="p">()</span> 
                <span class="c1"># this make sure that if the event loop integration is not </span>
                <span class="c1"># set up by the gui framework the plot will update</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">show</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display all output  </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">**Plot all begin**&#39;</span><span class="p">)</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_maps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_maps</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_distributions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_distributions</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_hsl_distributions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_hsl_distributions</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;**Plot all end**</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  
        
    <span class="k">def</span> <span class="nf">plot_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot maps</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Plotting maps...&#39;</span><span class="p">)</span>
        <span class="c1"># Hillshade view of source DTM with correct axis labeling</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_dtm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_dtm_shaded_relief</span><span class="p">()</span>
        <span class="c1"># Hillshade view of roi with correct axis labeling of pixels </span>
        <span class="c1">#   but not meters (for non 1m pixels)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_roi</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi_shaded_relief</span><span class="p">()</span>
        <span class="c1"># Streamlines, points  on semi-transparent shaded relief</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_streamlines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_streamlines</span><span class="p">()</span>
        <span class="c1"># Try to map channels etc</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_flow_maps</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_flow_maps</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_segments</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_segments</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_channels</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_hsl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_hsl</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_hsl_contoured</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_hsl_contoured</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_aspect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_aspect</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_hsl_aspect_distribution</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_hsl_aspect_distribution</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;...done&#39;</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">plot_dtm_shaded_relief</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hillshade view of source DTM</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">)</span>
        <span class="n">dtm_hillshade_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_hillshade</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">dtm_array</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">hillshade_azimuth</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">hillshade_angle</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dtm_hillshade_array</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> 
                  <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">dtm_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                          <span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">dtm_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="s1">&#39;dtm_shaded_relief&#39;</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">plot_roi_shaded_relief</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interp_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hillshade view of ROI of DTM</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi_shaded_relief_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> 
                                    <span class="n">color_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shaded_relief_color_alpha</span><span class="p">,</span>
                                    <span class="n">hillshade_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shaded_relief_hillshade_alpha</span><span class="p">,</span>
                                    <span class="n">interp_method</span><span class="o">=</span><span class="n">interp_method</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="s1">&#39;roi_shaded_relief&#39;</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_roi_shaded_relief_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">do_plot_color_relief</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">color_alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hillshade_alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">interp_method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hillshade view of ROI of DTM (overlay method)</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">do_basin_masking</span><span class="p">:</span>                
            <span class="n">mask_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">()[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_array</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">roi_hillshade_array</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">roi_hillshade_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_hillshade</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_array</span><span class="p">,</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">hillshade_azimuth</span><span class="p">,</span>
                                                               <span class="bp">self</span><span class="o">.</span><span class="n">hillshade_angle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">interp_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">interp_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span>
        
        <span class="k">if</span> <span class="n">do_plot_color_relief</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">do_plot_color_relief</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_color_shaded_relief</span>
        <span class="k">if</span> <span class="n">do_plot_color_relief</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">do_basin_masking</span><span class="p">:</span>                
                <span class="n">masked_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_array</span><span class="p">,</span>
                                                  <span class="n">mask</span><span class="o">=</span><span class="n">mask_array</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">masked_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_array</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">masked_array</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">terrain_cmap</span><span class="p">,</span> 
                        <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">],</span> 
                        <span class="n">alpha</span><span class="o">=</span><span class="n">color_alpha</span><span class="p">,</span>
                        <span class="n">interpolation</span><span class="o">=</span><span class="n">interp_method</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">roi_hillshade_array</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">,</span> 
                    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">],</span> 
                    <span class="n">alpha</span><span class="o">=</span><span class="n">hillshade_alpha</span><span class="p">,</span>
                    <span class="n">interpolation</span><span class="o">=</span><span class="n">interp_method</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">generate_hillshade</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">azimuth_degrees</span><span class="p">,</span> <span class="n">angle_altitude_degrees</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hillshade render DTM topo with light from direction azimuth_degrees and tilt</span>
<span class="sd">        angle_attitude_degrees</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_grad</span><span class="p">,</span> <span class="n">y_grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">x_grad</span><span class="p">,</span><span class="n">y_grad</span><span class="p">))</span>
        <span class="n">aspect</span> <span class="o">=</span> <span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">x_grad</span><span class="p">,</span> <span class="n">y_grad</span><span class="p">)</span>
         <span class="c1"># rotate from np array to true orientation</span>
        <span class="n">azimuth_radians</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">azimuth_degrees</span><span class="o">+</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">altitude_radians</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">angle_altitude_degrees</span><span class="p">)</span>
        <span class="n">shadedImage</span> <span class="o">=</span> <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">altitude_radians</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">altitude_radians</span><span class="p">)</span>
                       <span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">azimuth_radians</span> <span class="o">-</span> <span class="n">aspect</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">255</span><span class="o">*</span><span class="p">(</span><span class="n">shadedImage</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">plot_streamlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span><span class="o">=</span><span class="s1">&#39;streamlines&#39;</span>
        <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;streamlines&#39;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span>
                                    <span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi_shaded_relief_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span>
                        <span class="n">color_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">streamline_shaded_relief_color_alpha</span><span class="p">,</span>
                        <span class="n">hillshade_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">streamline_shaded_relief_hillshade_alpha</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_flow_vectors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_gradient_vector_field_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_downstreamlines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_updownstreamlines_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">do_down</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_upstreamlines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_updownstreamlines_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">do_down</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_seed_points</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_seed_points_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_blockages</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_blockages_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_loops</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_loops_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="c1"># Force map limits to match those of the ROI</span>
        <span class="c1">#   - turn this off to check for boundary overflow errors in e.g. streamlines</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">plot_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_reset_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">mapping_array</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Channels array not computed&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_reset_mask</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">reset_active_masks</span><span class="p">()</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;bwr&#39;</span>
        <span class="n">fig_name</span><span class="o">=</span><span class="s1">&#39;channels&#39;</span>
        <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;channels, midslopes &amp; ridges&#39;</span>
        <span class="n">do_flip_cmap</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">do_balance_cmap</span><span class="o">=</span><span class="kc">True</span>
                    
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span>
                                    <span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi_shaded_relief_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span>
                <span class="n">do_plot_color_relief</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">hillshade_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_shaded_relief_hillshade_alpha</span><span class="p">)</span>

        <span class="n">is_channel</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_channel</span>
        <span class="n">is_thinchannel</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_thinchannel</span>
        <span class="n">is_interchannel</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_interchannel</span>
        <span class="n">is_channelhead</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_channelhead</span>
        <span class="n">is_channeltail</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_channeltail</span>
        <span class="n">is_majorconfluence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_majorconfluence</span>
        <span class="n">is_minorconfluence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_minorconfluence</span>
        <span class="n">is_majorinflow</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_majorinflow</span>
        <span class="n">is_minorinflow</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_minorinflow</span>
        <span class="n">is_leftflank</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_leftflank</span>
        <span class="n">is_midslope</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_midslope</span>
        <span class="n">is_ridge</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_ridge</span>
        <span class="n">was_channelhead</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">was_channelhead</span>
        <span class="n">is_subsegmenthead</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_subsegmenthead</span>
        <span class="n">is_loop</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">is_loop</span>
        
        <span class="n">active_mask_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">()</span>
        
        <span class="n">grid_array</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">mapping_array</span> <span class="o">&amp;</span> <span class="n">is_thinchannel</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="n">active_mask_array</span> <span class="o">|</span> <span class="o">~</span><span class="p">(</span><span class="n">grid_array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_simple_grid</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

        <span class="n">grid_array</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">mapping_array</span> <span class="o">&amp;</span> <span class="n">is_midslope</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="n">fat_grid_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="n">dilation_structure</span> <span class="o">=</span> <span class="n">generate_binary_structure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">binary_dilation</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">dilation_structure</span><span class="p">,</span> 
                        <span class="n">iterations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_midslope_iterations</span><span class="p">,</span> 
                        <span class="n">output</span><span class="o">=</span><span class="n">fat_grid_array</span><span class="p">)</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="n">active_mask_array</span> <span class="o">|</span> <span class="o">~</span><span class="p">(</span><span class="n">fat_grid_array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_simple_grid</span><span class="p">(</span><span class="n">fat_grid_array</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greens&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        
        <span class="n">grid_array</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">mapping_array</span> <span class="o">&amp;</span> <span class="n">is_ridge</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="n">fat_grid_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="n">dilation_structure</span> <span class="o">=</span> <span class="n">generate_binary_structure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">binary_dilation</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">dilation_structure</span><span class="p">,</span>
                        <span class="n">iterations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_ridge_iterations</span><span class="p">,</span> 
                        <span class="n">output</span><span class="o">=</span><span class="n">fat_grid_array</span><span class="p">)</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="n">active_mask_array</span> <span class="o">|</span> <span class="o">~</span><span class="p">(</span><span class="n">fat_grid_array</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_simple_grid</span><span class="p">(</span><span class="n">fat_grid_array</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Oranges&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        
<span class="c1">#         self.plot_compound_markers(axes, is_majorconfluence, [&#39;blue&#39;,&#39;black&#39;])</span>
<span class="c1">#         self.plot_compound_markers(axes, is_loop,     [&#39;pink&#39;,&#39;black&#39;], msf=2)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_tails</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_compound_markers</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">is_channeltail</span><span class="p">,</span>    <span class="p">[</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span><span class="s1">&#39;black&#39;</span><span class="p">],</span> <span class="n">msf</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="c1">#         self.plot_compound_markers(axes, is_leftflank,     [&#39;purple&#39;,&#39;black&#39;], msf=0.2)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_heads</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_compound_markers</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">is_channelhead</span><span class="p">,</span>    <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="s1">&#39;black&#39;</span><span class="p">],</span> <span class="n">msf</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="c1">#         self.plot_compound_markers(axes, was_channelhead,   [&#39;orange&#39;,&#39;black&#39;], msf=0.3)</span>
<span class="c1">#         self.plot_compound_markers(axes, is_subsegmenthead,[&#39;orange&#39;,&#39;black&#39;], msf=0.25)</span>
<span class="c1">#         self.plot_compound_markers(axes, is_midslope,        [&#39;purple&#39;,&#39;black&#39;])</span>
<span class="c1">#         self.plot_compound_markers(axes, is_ridge,        [&#39;purple&#39;,&#39;black&#39;])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_compound_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">msf</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span>
        <span class="n">markers_array</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">mapping_array</span> <span class="o">&amp;</span> <span class="n">flag</span>
                                        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">-</span><span class="n">pad</span><span class="p">))</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_head_marker</span>
        <span class="n">marker_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ms</span><span class="o">*</span><span class="n">msf</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_head_marker_sizes</span><span class="p">]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_head_marker_alpha</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">markers_array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_origin</span><span class="p">,</span>
                  <span class="n">markers_array</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_origin</span><span class="p">,</span>
                  <span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">marker_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                  <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">markers_array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_origin</span><span class="p">,</span>
                  <span class="n">markers_array</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_origin</span><span class="p">,</span>
                  <span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="n">marker_sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_simple_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">grid_array</span><span class="p">,</span><span class="n">mask_array</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                         <span class="n">do_vlimit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">v_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid_array</span> <span class="o">=</span> <span class="n">grid_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">]</span>    
        <span class="n">mask_array</span> <span class="o">=</span> <span class="n">mask_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">]</span>    
        <span class="n">masked_grid_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask_array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_vlimit</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">masked_grid_array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> 
                      <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> 
                      <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">],</span>
                      <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                      <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span>
                      <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">masked_grid_array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> 
                      <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> 
                      <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">],</span>
                      <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                      <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">v_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">v_max</span>
                      <span class="p">)</span>
        <span class="n">clim</span><span class="o">=</span><span class="n">im</span><span class="o">.</span><span class="n">properties</span><span class="p">()[</span><span class="s1">&#39;clim&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">im</span>
    
    <span class="k">def</span> <span class="nf">plot_flow_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_flow_dsla</span><span class="p">:</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="s1">&#39;dsla&#39;</span>
            <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;dsla&#39;</span>     
            <span class="n">tmp_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">sla_array</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tmp_array</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_array</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">)]</span> \
                <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_array</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">)])</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_gridded_data</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">,</span>
                                   <span class="s1">&#39;gist_earth&#39;</span><span class="p">,</span> 
                                   <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> 
                                   <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">,</span>
                                   <span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span>
                                   <span class="n">do_flip_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_balance_cmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">tmp_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">slt_array</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tmp_array</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_array</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">)]</span> \
                <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">[(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tmp_array</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">)])</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_flow_dslt</span><span class="p">:</span>
            <span class="n">fig_name</span><span class="o">=</span><span class="s1">&#39;dslt&#39;</span>
            <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;dslt&#39;</span>     
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_gridded_data</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">,</span>
                                   <span class="s1">&#39;gist_earth&#39;</span><span class="p">,</span> <span class="c1">#&#39;seismic&#39;, </span>
                                   <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> 
                                   <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">,</span>
                                   <span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span>
                                   <span class="n">do_flip_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_balance_cmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">plot_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">do_shaded_relief</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span><span class="o">=</span><span class="s1">&#39;label&#39;</span>
        <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;label&#39;</span>     
        <span class="n">tmp_array</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">coarse_subsegment_array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
<span class="c1">#         pdebug(&#39;label&#39;, tmp_array.shape,np.unique(tmp_array))</span>
<span class="c1">#         tmp_array[tmp_array!=1]=0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">add_active_mask</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;merged_coarse_mask_array&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">merged_coarse_mask_array</span><span class="p">})</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">()</span>
<span class="c1">#         pdebug(&#39;list_active_masks&#39;,self.state.list_active_masks())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_gridded_data</span><span class="p">(</span><span class="n">tmp_array</span><span class="p">,</span>
                               <span class="s1">&#39;randomized&#39;</span><span class="p">,</span> 
                               <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">,</span>
                               <span class="n">mask_array</span><span class="o">=</span><span class="n">mask_array</span><span class="p">,</span>
                               <span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span>
                               <span class="n">do_shaded_relief</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                               <span class="n">do_flip_cmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_balance_cmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_hsl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">z_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">z_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">z_pctile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_shaded_relief</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">colorbar_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_aspect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span><span class="o">=</span><span class="s1">&#39;hsl&#39;</span>
        <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;hsl&#39;</span>     
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_cmap</span>
        <span class="k">if</span> <span class="n">colorbar_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_colorbar_size</span>
        <span class="k">if</span> <span class="n">colorbar_aspect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar_aspect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_colorbar_aspect</span>
        <span class="k">if</span> <span class="n">do_shaded_relief</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">do_shaded_relief</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_do_shaded_relief</span>
        <span class="k">if</span> <span class="n">z_pctile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z_pctile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_z_pctile</span>
        <span class="k">if</span> <span class="n">z_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_z_min</span><span class="o">==</span><span class="s1">&#39;full&#39;</span><span class="p">:</span>
                <span class="n">z_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_array</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_z_min</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span>
                <span class="n">z_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_array</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">z_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_z_min</span>
        <span class="k">if</span> <span class="n">z_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_z_max</span><span class="o">==</span><span class="s1">&#39;full&#39;</span><span class="p">:</span>
                <span class="n">z_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_array</span><span class="p">,</span><span class="mf">100.0</span><span class="p">)</span>  
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_z_max</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span>
                <span class="n">z_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_array</span><span class="p">,</span><span class="n">z_pctile</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="n">z_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hsl_z_max</span>
        <span class="n">grid_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_array</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">z_min</span><span class="p">,</span><span class="n">z_max</span><span class="p">)</span>
<span class="c1">#         mask_array = np.zeros_like(grid_array).astype(np.bool)</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">()</span>
        <span class="n">mask_array</span><span class="p">[</span><span class="n">grid_array</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1">#         pdebug(&#39;list_active_masks&#39;,self.state.list_active_masks())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_gridded_data</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="p">,</span>  <span class="c1"># rainbow</span>
                               <span class="n">mask_array</span><span class="o">=</span><span class="n">mask_array</span><span class="p">,</span>
                               <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">,</span>
                               <span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span>
                               <span class="n">do_flip_cmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_balance_cmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">do_shaded_relief</span><span class="o">=</span><span class="n">do_shaded_relief</span><span class="p">,</span> 
                               <span class="n">do_colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                               <span class="n">colorbar_title</span><span class="o">=</span><span class="s1">&#39;hillslope length [m]&#39;</span><span class="p">,</span>
                               <span class="n">colorbar_size</span><span class="o">=</span><span class="n">colorbar_size</span><span class="p">,</span>
                               <span class="n">colorbar_aspect</span><span class="o">=</span><span class="n">colorbar_aspect</span><span class="p">,</span>
                               <span class="n">grid_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hsl_alpha</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">plot_hsl_contoured</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">do_colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="s1">&#39;hillslope length [m]&#39;</span><span class="p">,</span>
                           <span class="n">n_contours</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contour_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">z_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">z_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">z_pctile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_shaded_relief</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">colorbar_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_aspect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">contour_label_suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">contour_label_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">do_plot_contours</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span><span class="o">=</span><span class="s1">&#39;hsl_contours&#39;</span>
        <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;hsl contours&#39;</span>    
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span>
                                    <span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">)</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span>
        <span class="n">pslice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="n">pad</span><span class="p">:</span><span class="o">-</span><span class="n">pad</span><span class="p">,</span><span class="n">pad</span><span class="p">:</span><span class="o">-</span><span class="n">pad</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_cmap</span>
        <span class="k">if</span> <span class="n">do_plot_contours</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">do_plot_contours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_hsl_contours</span>
        <span class="k">if</span> <span class="n">colorbar_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_colorbar_size</span>
        <span class="k">if</span> <span class="n">colorbar_aspect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar_aspect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_colorbar_aspect</span>
        <span class="k">if</span> <span class="n">do_shaded_relief</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">do_shaded_relief</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_do_shaded_relief</span>
        <span class="k">if</span> <span class="n">contour_label_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">contour_label_fontsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_label_fontsize</span>
        <span class="k">if</span> <span class="n">contour_label_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">contour_label_suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_label_suffix</span>
        <span class="k">if</span> <span class="n">z_pctile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z_pctile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_z_pctile</span>
        <span class="k">if</span> <span class="n">z_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_z_min</span><span class="o">==</span><span class="s1">&#39;full&#39;</span><span class="p">:</span>
                <span class="n">z_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_smoothed_array</span><span class="p">[</span><span class="n">pslice</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_z_min</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span>
                <span class="n">z_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_smoothed_array</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">z_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_z_min</span>
        <span class="k">if</span> <span class="n">z_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_z_max</span><span class="o">==</span><span class="s1">&#39;full&#39;</span><span class="p">:</span>
                <span class="n">z_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_smoothed_array</span><span class="p">,</span><span class="mf">100.0</span><span class="p">)</span>  
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_z_max</span><span class="o">==</span><span class="s1">&#39;auto&#39;</span><span class="p">:</span>
                <span class="n">z_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_array</span><span class="p">,</span><span class="n">z_pctile</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="n">z_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_z_max</span>     
        <span class="n">grid_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_smoothed_array</span><span class="p">[</span><span class="n">pslice</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">z_min</span><span class="p">,</span><span class="n">z_max</span><span class="p">)</span>
<span class="c1">#         if n_contours is None and self.contour_hsl_n_contours!=&#39;auto&#39;:</span>
<span class="c1">#                 n_contours = self.contour_hsl_n_contours</span>
        <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_linewidth</span>
                
        <span class="n">mask_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">()[</span><span class="n">pslice</span><span class="p">]</span>
        <span class="n">mask_array</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_array</span><span class="p">[</span><span class="n">pslice</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1">#         pdebug(&#39;list_active_masks&#39;,self.state.list_active_masks())</span>
<span class="c1">#         mask_array &amp;= False</span>
        <span class="k">if</span> <span class="n">do_shaded_relief</span><span class="p">:</span>
            <span class="n">hillshade_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_shaded_relief_hillshade_alpha</span>
            <span class="n">hsl_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_hsl_alpha</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hillshade_alpha</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">hsl_alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi_shaded_relief_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">do_plot_color_relief</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                            <span class="n">hillshade_alpha</span><span class="o">=</span><span class="n">hillshade_alpha</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_simple_grid</span><span class="p">((</span><span class="n">grid_array</span><span class="p">),</span>
                              <span class="n">mask_array</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">hsl_alpha</span><span class="p">,</span><span class="n">do_vlimit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#         if do_colorbar:</span>
<span class="c1">#             divider = make_axes_locatable(axes)</span>
<span class="c1">#             cax = divider.append_axes(&quot;bottom&quot;, size=&quot;4%&quot;, </span>
<span class="c1">#                                       pad=0.5, aspect=colorbar_aspect)</span>
<span class="c1">#             cbar = plt.colorbar(im, cax=cax, orientation=&quot;horizontal&quot;)</span>
<span class="c1">#             cbar.set_label(colorbar_title)</span>
            
        <span class="k">if</span> <span class="n">do_colorbar</span><span class="p">:</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colorbar_size</span><span class="p">),</span> 
                                      <span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">colorbar_aspect</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colorbar_title</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">do_plot_contours</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_contours_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="n">grid_array</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask_array</span><span class="p">,</span>
                                       <span class="n">n_contours</span><span class="o">=</span><span class="n">n_contours</span><span class="p">,</span>
                                       <span class="n">contour_interval</span><span class="o">=</span><span class="n">contour_interval</span><span class="p">,</span>
                                       <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                                       <span class="n">contour_label_suffix</span><span class="o">=</span><span class="n">contour_label_suffix</span><span class="p">,</span> 
                                       <span class="n">contour_label_fontsize</span><span class="o">=</span><span class="n">contour_label_fontsize</span><span class="p">)</span>
        <span class="c1"># Force map limits to match those of the ROI</span>
        <span class="c1">#   - turn this off to check for boundary overflow errors in e.g. streamlines</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">plot_aspect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">do_plot_contours</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">contour_label_suffix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contour_label_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span><span class="o">=</span><span class="s1">&#39;aspect&#39;</span>
        <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;aspect&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">aspect_array</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Aspect array not computed&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cmap</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;RdYlBu&#39;</span> <span class="c1">#&#39;seismic&#39;  #bwr</span>
        <span class="n">do_flip_cmap</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">do_balance_cmap</span><span class="o">=</span><span class="kc">True</span>
        <span class="k">if</span> <span class="n">do_plot_contours</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">do_plot_contours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_plot_aspect_contours</span>
        <span class="k">if</span> <span class="n">contour_label_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">contour_label_fontsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_label_fontsize</span>
        <span class="k">if</span> <span class="n">contour_label_suffix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">contour_label_suffix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contour_aspect_label_suffix</span>
                            
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span>
                                    <span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">add_active_mask</span><span class="p">({</span><span class="s1">&#39;merged_coarse&#39;</span><span class="p">:</span> 
                                    <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">merged_coarse_mask_array</span><span class="p">})</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">()</span>
        <span class="n">grid_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">aspect_array</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi_shaded_relief_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span>
                <span class="n">do_plot_color_relief</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color_alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">hillshade_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_shaded_relief_hillshade_alpha</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_simple_grid</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span> <span class="n">mask_array</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> 
                                   <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">do_vlimit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">v_min</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span> <span class="n">v_max</span><span class="o">=+</span><span class="mi">180</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_plot_contours</span><span class="p">:</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span>
            <span class="n">pslice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="n">pad</span><span class="p">:</span><span class="o">-</span><span class="n">pad</span><span class="p">,</span><span class="n">pad</span><span class="p">:</span><span class="o">-</span><span class="n">pad</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_contours_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span>
                                       <span class="n">grid_array</span><span class="p">[</span><span class="n">pslice</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                       <span class="n">mask</span><span class="o">=</span><span class="n">mask_array</span><span class="p">[</span><span class="n">pslice</span><span class="p">],</span>
                                       <span class="n">contour_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                       <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">contour_label_suffix</span><span class="o">=</span><span class="n">contour_label_suffix</span><span class="p">,</span> 
                                       <span class="n">contour_label_fontsize</span><span class="o">=</span><span class="n">contour_label_fontsize</span><span class="p">)</span>
        
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>  <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                                  <span class="n">size</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contour_aspect_colorbar_size</span><span class="p">),</span> 
                                  <span class="n">aspect</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">contour_aspect_colorbar_aspect</span><span class="p">)</span>
        <span class="n">ticks</span>       <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">180</span><span class="p">]</span>
        <span class="n">tick_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;W&#39;</span><span class="p">]</span>
        <span class="c1"># Omit top W tick/label</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                            <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="c1">#         cbar.set_label(&#39;aspect&#39;, rotation=0,y=-0.1,labelpad=-20)</span>
<span class="c1">#         cbar.ax.set_yticklabels([r&#39;-180$\degree$&#39;,r&#39;-90$\degree$&#39;,</span>
<span class="c1">#                                  r&#39;0$\degree$ E&#39;,</span>
<span class="c1">#                                  r&#39;+90$\degree$&#39;,r&#39;+180$\degree$&#39;])</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">tick_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">reset_active_masks</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_hsl_aspect_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">hsl_aspect_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_aspect_averages_array</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;HSL-aspect array not computed&#39;</span><span class="p">)</span>
            
        <span class="n">fig_name</span><span class="o">=</span><span class="s1">&#39;hsl_aspect_distribution&#39;</span>
        <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;HSL-aspect distribution&#39;</span>
                    
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span>
                                    <span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">,</span>
                                    <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>
        <span class="n">hsl</span> <span class="o">=</span> <span class="n">hsl_aspect_array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hsl_aspect_array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">asp</span> <span class="o">=</span> <span class="n">hsl_aspect_array</span><span class="p">[:,</span><span class="mi">1</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hsl_aspect_array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">hsl_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">hsl</span><span class="p">)</span>
        <span class="n">hsl_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">hsl</span><span class="p">)</span>
        <span class="n">n_bins</span>  <span class="o">=</span> <span class="n">hsl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hsl_north</span> <span class="o">=</span> <span class="n">hsl</span><span class="p">[</span><span class="n">asp</span><span class="o">&gt;=</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="n">asp_north</span> <span class="o">=</span> <span class="n">asp</span><span class="p">[</span><span class="n">asp</span><span class="o">&gt;=</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="n">hsl_south</span> <span class="o">=</span> <span class="n">hsl</span><span class="p">[</span><span class="n">asp</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="n">asp_south</span> <span class="o">=</span> <span class="n">asp</span><span class="p">[</span><span class="n">asp</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hsl_north</span><span class="o">!=</span><span class="p">[]</span> <span class="ow">and</span> <span class="n">hsl_south</span><span class="o">!=</span><span class="p">[]:</span>
            <span class="n">hsl_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span> 
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hsl_north</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]),</span> <span class="n">hsl_north</span><span class="p">,</span> 
                 <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hsl_south</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hsl_north</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="mf">2.0</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">asp_north</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span> <span class="n">asp_north</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]))</span> <span class="p">)</span>
            <span class="n">hsl_south</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                 <span class="p">(</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hsl_south</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hsl_north</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> 
                  <span class="n">hsl_south</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hsl_south</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
            <span class="n">asp_south</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                 <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">]),</span> <span class="n">asp_south</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]))</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;Greys&#39;</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">rgba_north</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_mean_north</span><span class="o">-</span><span class="n">hsl_min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">hsl_max</span><span class="o">-</span><span class="n">hsl_min</span><span class="p">))</span>
        <span class="n">rgba_south</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_mean_south</span><span class="o">-</span><span class="n">hsl_min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">hsl_max</span><span class="o">-</span><span class="n">hsl_min</span><span class="p">))</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">asp_north</span><span class="p">,</span> <span class="n">hsl_north</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">rgba_north</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">asp_south</span><span class="p">,</span> <span class="n">hsl_south</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">rgba_south</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">asp</span><span class="p">,</span> <span class="n">hsl</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
<span class="c1">#         axes.set_theta_zero_location(&#39;N&#39;)</span>
<span class="c1">#         axes.set_theta_direction(-1)</span>
        <span class="n">c_interval</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">while</span> <span class="n">c_interval</span><span class="o">&lt;=</span><span class="mi">100</span><span class="p">:</span>
            <span class="n">c_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">hsl_max</span><span class="o">//</span><span class="n">c_interval</span><span class="p">)</span><span class="o">*</span><span class="n">c_interval</span>
            <span class="n">c_count</span> <span class="o">=</span> <span class="n">c_max</span><span class="o">/</span><span class="n">c_interval</span>
            <span class="k">if</span> <span class="n">c_count</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">c_interval</span> <span class="o">*=</span> <span class="mi">2</span>        
        <span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c_max</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">c_interval</span><span class="p">,</span><span class="n">c_interval</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="n">band_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band</span><span class="p">)</span> <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">]</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_rgrids</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">band_labels</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">45</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
        <span class="n">spc</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{space}</span><span class="s1">&#39;</span>
        <span class="n">angle_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">spc</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;0$\degree$ = E&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;45$\degree$&#39;</span><span class="p">,</span>
                        <span class="sa">r</span><span class="s1">&#39;90$\degree$ = N&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;135$\degree$&#39;</span><span class="p">,</span>
                        <span class="sa">r</span><span class="s1">&#39;$\pm$180$\degree$&#39;</span><span class="o">+</span><span class="n">spc</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;-135$\degree$&#39;</span><span class="o">+</span><span class="n">spc</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span>
                        <span class="sa">r</span><span class="s1">&#39;-90$\degree$ = S&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;-45$\degree$&#39;</span><span class="p">]</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_thetagrids</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">angle_labels</span><span class="p">)</span>
<span class="c1">#         axes.tick_params(pad=8)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
        
        <span class="n">mha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_mean_azimuth</span><span class="p">)</span>
        <span class="n">mhm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_mean_magnitude</span>
        <span class="n">mhl</span> <span class="o">=</span> <span class="n">hsl_max</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">head_length</span> <span class="o">=</span> <span class="mi">40</span>   <span class="c1"># hack - how to correctly scale??</span>
        <span class="n">arrow_style</span> <span class="o">=</span> <span class="n">ArrowStyle</span><span class="o">.</span><span class="n">Fancy</span><span class="p">(</span><span class="n">head_length</span><span class="o">=</span><span class="n">head_length</span><span class="p">,</span><span class="n">head_width</span><span class="o">=</span><span class="n">head_length</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">tail_width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">arrow_patch</span> <span class="o">=</span> <span class="n">FancyArrowPatch</span><span class="p">((</span><span class="n">mha</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">mhl</span><span class="o">/</span><span class="mf">3.0</span><span class="p">),</span> <span class="p">(</span><span class="n">mha</span><span class="p">,</span><span class="n">mhl</span><span class="p">),</span>
                                      <span class="n">shrinkA</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shrinkB</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                      <span class="n">arrowstyle</span><span class="o">=</span><span class="n">arrow_style</span><span class="p">,</span>
                                      <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> 
                                      <span class="n">linewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">arrow_patch</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mha</span><span class="p">,</span><span class="n">mhm</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mha</span><span class="p">,</span><span class="n">mhm</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">)</span>

        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;purple&#39;</span>
        <span class="n">h_position</span> <span class="o">=</span> <span class="n">hsl_max</span><span class="o">/</span><span class="mf">1.8</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">145</span><span class="p">),</span> <span class="n">h_position</span><span class="p">,</span> 
                  <span class="sa">r</span><span class="s1">&#39;$\overline{\mathbf</span><span class="si">{L}</span><span class="s1">}_\mathbf</span><span class="si">{N}</span><span class="s1">=$&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{:2.0f}</span><span class="s1">m&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_mean_north</span><span class="p">),</span>
                  <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                  <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">145</span><span class="p">),</span> <span class="n">h_position</span><span class="p">,</span> 
                  <span class="sa">r</span><span class="s1">&#39;$\overline{\mathbf</span><span class="si">{L}</span><span class="s1">}_\mathbf</span><span class="si">{S}</span><span class="s1">=$&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">{:2.0f}</span><span class="s1">m&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_mean_south</span><span class="p">),</span>
                  <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
                  <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_contours_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_contours</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">contour_interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">contour_label_suffix</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">contour_label_fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_pixel_centers_array</span><span class="p">,</span><span class="n">y_pixel_centers_array</span> \
            <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">x_roi_n_pixel_centers</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">y_roi_n_pixel_centers</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="c1">#         z_min = np.percentile(Z, 1.0)</span>
        <span class="n">z_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="mf">100.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n_contours</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">contour_interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">c_interval</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c_interval</span> <span class="o">=</span> <span class="n">contour_interval</span>
            <span class="k">while</span> <span class="n">c_interval</span><span class="o">&lt;</span><span class="mi">50</span><span class="p">:</span>
                <span class="n">c_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span><span class="o">//</span><span class="n">c_interval</span><span class="p">)</span><span class="o">*</span><span class="n">c_interval</span>
                <span class="n">c_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">z_max</span><span class="o">//</span><span class="n">c_interval</span><span class="p">)</span><span class="o">*</span><span class="n">c_interval</span>
                <span class="n">c_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">c_max</span><span class="o">-</span><span class="n">c_min</span><span class="p">)</span><span class="o">/</span><span class="n">c_interval</span>
                <span class="k">if</span> <span class="n">c_count</span><span class="o">&lt;=</span><span class="mi">17</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">c_interval</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="n">n_contours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">c_min</span><span class="p">,</span><span class="n">c_max</span><span class="o">+</span><span class="n">c_interval</span><span class="p">,</span><span class="n">c_interval</span><span class="p">)</span>
        <span class="n">contours</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x_pixel_centers_array</span><span class="p">,</span><span class="n">y_pixel_centers_array</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span>
                                <span class="n">n_contours</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">contour_label_suffix</span><span class="p">,</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">contour_label_fontsize</span><span class="p">);</span>

    <span class="k">def</span> <span class="nf">plot_hsl_distributions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_stretch</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Plotting hillslope length distributions...&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_aspect_df</span>    
        
        <span class="k">if</span> <span class="n">x_stretch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_stretch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mhsl_pdf_x_stretch</span>
        <span class="n">hsl_n</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">hsl</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">aspect</span><span class="o">&gt;</span><span class="mi">45</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">aspect</span><span class="o">&lt;</span><span class="mi">135</span><span class="p">)]</span>
        <span class="n">hsl_s</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">hsl</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">aspect</span><span class="o">&lt;-</span><span class="mi">45</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">aspect</span><span class="o">&gt;-</span><span class="mi">135</span><span class="p">)]</span>
        
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;hsl_nsall_distbn&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;N-facing vs S-facing hillslope length distributions&#39;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">axes</span>  <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hsl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="c1">#style=&#39;-.&#39;,</span>
                                      <span class="n">label</span><span class="o">=</span><span class="s1">&#39;360°&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">secondary_y</span><span class="o">=</span><span class="s1">&#39;360°&#39;</span><span class="p">)</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hsl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x_stretch</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">axes2</span> <span class="o">=</span> <span class="n">hsl_n</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;steelblue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;N-facing&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">axes2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">axes3</span> <span class="o">=</span> <span class="n">hsl_s</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;S-facing&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">axes3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">axes2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axes_ns</span> <span class="o">=</span> <span class="n">axes3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes_ns</span> <span class="o">=</span> <span class="n">axes2</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">axes_ns</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span>
        <span class="n">axes_ns</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;distance $L$  [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;probability density  $f(L)$  [m$^{-1}$]&#39;</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
        <span class="n">axes_ns</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">axes_ns</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x_max</span><span class="p">)</span>
        <span class="n">axes_ns</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x_max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;hsl_ns_qq&#39;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Hillslope length-aspect Q-Q plot&#39;</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;South-facing HSL $L_S$ percentiles  [m]&#39;</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;North-facing HSL $L_N$ percentiles  [m]&#39;</span>
            <span class="n">hsl_ns_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_min</span>
            <span class="n">hsl_ns_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_max</span>
            <span class="n">hsls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">hsl_ns_min</span><span class="p">,</span> <span class="n">hsl_ns_max</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
            <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_qq_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_qq_array</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                     <span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span> <span class="p">)</span> <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
            <span class="c1"># Find plot limits (not tight)</span>
            <span class="n">xy_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">xy_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span><span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># Force equal x,y limits</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xy_min</span><span class="p">,</span><span class="n">xy_max</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xy_min</span><span class="p">,</span><span class="n">xy_max</span><span class="p">)</span>
            <span class="c1"># Plot a diagonal x=y red dashed line for guidance</span>
            <span class="n">hsls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xy_min</span><span class="p">,</span> <span class="n">xy_max</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hsls</span><span class="p">,</span><span class="n">hsls</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Replot to ensure q-q line is on top</span>
            <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_qq_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_qq_array</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                     <span class="n">marker</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span> <span class="p">)</span> <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;hsl_ns_pp&#39;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Hillslope length-aspect P-P plot&#39;</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
            <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;North-facing HSL cumulative prob $F(L_N)$  [%]&#39;</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;South-facing HSL cumulative prob $F(L_S)$  [%]&#39;</span>
            <span class="n">percents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_pp_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">percents</span><span class="p">,</span><span class="n">percents</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_pp_array</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_pp_array</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                              <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_pp_array</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                              <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_pp_array</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_ns_pp_array</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
                     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="c1">#         plt.autoscale(tight=True)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">100.25</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">100.25</span><span class="p">)</span>
            <span class="n">dxy</span> <span class="o">=</span> <span class="mf">0.025</span>
            <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">ns</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.5</span><span class="o">+</span><span class="n">ns</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;longer </span><span class="si">{}</span><span class="s1">-facing&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ns</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> 
                      <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                      <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">axes</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> 
                      <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="p">((</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">dxy</span><span class="p">),(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">dxy</span><span class="p">))]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>    
    
        <span class="k">return</span>
    
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;hsl_means_distbn&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Distribution of means of hillslope length&#39;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">hsl_stats_df</span>
        <span class="c1"># Cut</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">kde_min_labels</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">x_label</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;distance $L$  [m]&#39;</span>
        <span class="n">y_label</span>  <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;probability density  $f(L)$  [m$^{-1}$]&#39;</span>
        <span class="n">y_label2</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;number  $N(L)$  [$-$]&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">kde_min_labels</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mean [m]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span><span class="n">secondary_y</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
            <span class="n">axes2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mean [m]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
            <span class="n">axes2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mean [m]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mean [m]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x_stretch</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;hsl_stddevs_distbn&#39;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Hillslope length standard deviations&#39;</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">kde_min_labels</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stddev [m]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;stddev [m]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;distance std deviation $\sigma_L$  [m]&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;probability density  $f(\sigma_L)$  [m$^{-1}$]&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;stddev [m]&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.99</span><span class="p">))</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># axes.legend([&#39;hillslope length std dev&#39;],frameon=False)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>
  
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;hsl_counts_distbn&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">csum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
            <span class="n">cmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.99</span><span class="p">))</span>
            <span class="n">n_bins</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">csum</span><span class="o">//</span><span class="n">cmax</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">n_bins</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Hillslope length streamline counts&#39;</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">n_bins</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;number of streamlines per length average $N_</span><span class="si">{sl}</span><span class="s1">$   [-]&#39;</span><span class="p">);</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;frequency  $n(N_</span><span class="si">{sl}</span><span class="s1">)$  [-]&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="mf">0.99</span><span class="p">))</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;...done&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_gridded_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid_array</span><span class="p">,</span> <span class="n">gridded_cmap</span><span class="p">,</span> 
                          <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">do_flip_cmap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_balance_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">do_shaded_relief</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                          <span class="n">colorbar_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_aspect</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span>
                          <span class="n">colorbar_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">grid_alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streamlines, points on semi-transparent shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mask_array</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">grid_array</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span>
        <span class="n">pslice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">index_exp</span><span class="p">[</span><span class="n">pad</span><span class="p">:</span><span class="o">-</span><span class="n">pad</span><span class="p">,</span><span class="n">pad</span><span class="p">:</span><span class="o">-</span><span class="n">pad</span><span class="p">]</span>
        <span class="n">mask_array</span> <span class="o">=</span> <span class="n">mask_array</span><span class="p">[</span><span class="n">pslice</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">extent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">do_basin_masking</span><span class="p">:</span>
            <span class="n">mask_array</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">()[</span><span class="n">pslice</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_point_marker_size</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">seed_point_marker</span> <span class="o">=</span> <span class="s1">&#39;g,&#39;</span>
            <span class="n">seed_point_marker_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">seed_point_marker</span> <span class="o">=</span> <span class="s1">&#39;gD&#39;</span>     
            <span class="n">seed_point_marker_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_point_marker_size</span>
            
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span>
                                    <span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">do_shaded_relief</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi_shaded_relief_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">do_plot_color_relief</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">color_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_shaded_relief_color_alpha</span><span class="p">,</span>
                    <span class="n">hillshade_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_shaded_relief_hillshade_alpha</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">grid_alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">grid_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamline_density_alpha</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grid_alpha</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="n">grid_array</span> <span class="o">=</span> <span class="n">grid_array</span><span class="p">[</span><span class="n">pslice</span><span class="p">]</span>
<span class="c1">#         extra_mask_array = grid_array.astype(np.bool)</span>
<span class="c1">#         mask_array = mask_array | (~extra_mask_array)</span>
<span class="c1">#         mask_array &amp;= False</span>
        <span class="n">masked_grid_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">grid_array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask_array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_flip_cmap</span><span class="p">:</span>
            <span class="n">masked_grid_array</span> <span class="o">=</span> <span class="o">-</span><span class="n">masked_grid_array</span>
            
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">masked_grid_array</span><span class="p">[</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">masked_grid_array</span><span class="p">))</span>
                                 <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">masked_grid_array</span><span class="p">))</span> <span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">masked_grid_array</span><span class="p">[</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">masked_grid_array</span><span class="p">))</span>
                                 <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">masked_grid_array</span><span class="p">))</span> <span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">do_balance_cmap</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">vmin</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">abs</span><span class="p">(</span><span class="n">vmax</span><span class="p">):</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="o">-</span><span class="n">vmin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">vmax</span>
        <span class="k">if</span> <span class="n">gridded_cmap</span><span class="o">==</span><span class="s1">&#39;randomized&#39;</span><span class="p">:</span>
            <span class="n">gridded_cmap</span> <span class="o">=</span> <span class="n">random_colormap</span><span class="p">(</span><span class="n">cmap_name</span><span class="o">=</span><span class="s1">&#39;randomized&#39;</span><span class="p">,</span> 
                                               <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_cmap_seed</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">masked_grid_array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> 
                  <span class="n">cmap</span><span class="o">=</span><span class="n">gridded_cmap</span><span class="p">,</span> 
                  <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                  <span class="n">alpha</span><span class="o">=</span><span class="n">grid_alpha</span><span class="p">,</span>
                  <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="p">,</span>
                  <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span>
                  <span class="p">)</span>
        <span class="n">clim</span><span class="o">=</span><span class="n">im</span><span class="o">.</span><span class="n">properties</span><span class="p">()[</span><span class="s1">&#39;clim&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">do_colorbar</span><span class="p">:</span>
            <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">colorbar_size</span><span class="p">),</span> 
                                      <span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="n">colorbar_aspect</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colorbar_title</span><span class="p">)</span>

<span class="c1">#         try:</span>
<span class="c1">#             is_thinchannel = self.mapping.info.is_thinchannel</span>
<span class="c1">#             grid_array = ( self.mapping.mapping_array[pslice] </span>
<span class="c1">#                            &amp; is_thinchannel ).astype(np.bool)</span>
<span class="c1">#             im = axes.imshow(np.flipud(grid_array.T), </span>
<span class="c1">#                       cmap=&#39;Blues&#39;, </span>
<span class="c1">#                       extent=[*self.geodata.roi_x_bounds,*self.geodata.roi_y_bounds],</span>
<span class="c1">#                       alpha=0.5,</span>
<span class="c1">#                       interpolation=self.interpolation_method</span>
<span class="c1">#                       )</span>
<span class="c1">#         except:</span>
<span class="c1">#             pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_updownstreamlines_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">do_down</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Up or downstreamlines </span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">do_down</span><span class="p">:</span>
            <span class="n">up_or_down_str</span> <span class="o">=</span> <span class="s1">&#39;down&#39;</span>
            <span class="n">streamline_arrays_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">streamline_arrays_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">downstreamline_color</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">up_or_down_str</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>
            <span class="n">streamline_arrays_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">streamline_arrays_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upstreamline_color</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamline_point_marker</span>   
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamline_point_size</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamline_linewidth</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamline_point_alpha</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">n_streamlines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">streamline_arrays_list</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">idx_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_streamlines</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_rng_seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shuffle_rng_seed</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_streamlines_limit</span><span class="o">!=</span><span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">shuffle</span><span class="p">(</span><span class="n">idx_list</span><span class="p">)</span>
            <span class="n">idx_list</span> <span class="o">=</span> <span class="n">idx_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">min</span><span class="p">(</span><span class="n">n_streamlines</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_streamlines_limit</span><span class="p">)]</span>

        <span class="n">todo</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_streamlines_limit</span><span class="o">!=</span><span class="s1">&#39;none&#39;</span> <span class="ow">and</span> <span class="n">n_streamlines</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">n_streamlines_limit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Plotting </span><span class="si">{0:,}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">todo</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span>
                  <span class="o">+</span><span class="n">up_or_down_str</span><span class="o">+</span><span class="s1">&#39;streamlines&#39;</span>
                  <span class="o">+</span><span class="s1">&#39; randomly sampled from a set of </span><span class="si">{0:,}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_streamlines</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Plotting all </span><span class="si">{0:,}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">-streamlines&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">todo</span><span class="p">,</span><span class="n">up_or_down_str</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Progress: &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">progress</span> <span class="o">=</span> <span class="mi">0</span>    
        <span class="k">if</span> <span class="n">todo</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">max_length</span><span class="o">&gt;=</span><span class="mi">300000</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_interval</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">todo</span><span class="o">//</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">todo</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">max_length</span><span class="o">&gt;=</span><span class="mi">100000</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_interval</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">todo</span><span class="o">//</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_interval</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">todo</span><span class="o">//</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sidx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">todo</span><span class="p">):</span> 
            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                        <span class="n">streamline_arrays_list</span><span class="p">[</span><span class="n">idx_list</span><span class="p">[</span><span class="n">sidx</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
                                    <span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">trajectory_resolution</span><span class="p">)))</span>
            <span class="n">seed_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">seed_point_array</span><span class="p">[</span><span class="n">idx_list</span><span class="p">[</span><span class="n">sidx</span><span class="p">],:]</span>
            <span class="n">x_vec</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_origin</span>
                      <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                      <span class="o">+</span> <span class="n">seed_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">y_vec</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_origin</span>
                      <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">trajectory</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                      <span class="o">+</span> <span class="n">seed_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

            <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span><span class="n">y_vec</span><span class="p">,</span>
                      <span class="n">marker</span><span class="p">,</span> 
                      <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                      <span class="n">ms</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> 
                      <span class="n">lw</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                      <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                      <span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
    
            <span class="n">progress</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">progress</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">print_interval</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">prog</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">100</span><span class="o">*</span><span class="n">progress</span><span class="o">/</span><span class="n">todo</span><span class="p">)</span><span class="o">//</span><span class="mi">100</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">prog</span><span class="o">!=</span><span class="mi">100</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>       
 
        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>    
    
    <span class="k">def</span> <span class="nf">plot_classical_streamlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Classic streamlines on color shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi_shaded_relief_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> 
                        <span class="n">color_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">streamline_shaded_relief_color_alpha</span><span class="p">,</span>
                        <span class="n">hillshade_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">streamline_shaded_relief_hillshade_alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_classical_streamlines_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="s1">&#39;classical_streamlines&#39;</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_classical_streamlines_and_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                               <span class="n">sl_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">vec_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                               <span class="n">vec_alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vec_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Classic streamlines and gradient vector field on color shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi_shaded_relief_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> 
                        <span class="n">color_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">streamline_shaded_relief_color_alpha</span><span class="p">,</span>
                        <span class="n">hillshade_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">streamline_shaded_relief_hillshade_alpha</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sl_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sl_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">downstreamline_color</span>
        <span class="k">if</span> <span class="n">vec_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vec_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient_vector_color</span>        
        <span class="k">if</span> <span class="n">vec_alpha</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vec_alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient_vector_alpha</span>       
        <span class="k">if</span> <span class="n">vec_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vec_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient_vector_scale</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_gradient_vector_field_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">vec_color</span><span class="o">=</span><span class="n">vec_color</span><span class="p">,</span>
                                                <span class="n">vec_alpha</span><span class="o">=</span><span class="n">vec_alpha</span><span class="p">,</span> <span class="n">vec_scale</span><span class="o">=</span><span class="n">vec_scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_classical_streamlines_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">sl_color</span><span class="o">=</span><span class="n">sl_color</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">top</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="s1">&#39;classical_streamlines_and_vectors&#39;</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_classical_streamlines_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span> <span class="n">sl_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Classic streamlines (overlay method)</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_pixel_centers_array</span><span class="p">,</span><span class="n">y_pixel_centers_array</span> \
            <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">x_roi_n_pixel_centers</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">y_roi_n_pixel_centers</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">x_pixel_centers_array</span><span class="p">,</span><span class="n">y_pixel_centers_array</span><span class="p">,</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">uv_array</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">())</span><span class="o">.</span><span class="n">T</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">],</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">uv_array</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">())</span><span class="o">.</span><span class="n">T</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">:</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">pad_width</span><span class="p">],</span> 
                      <span class="n">density</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">classical_streamplot_density</span><span class="p">),</span> 
                      <span class="n">color</span><span class="o">=</span><span class="n">sl_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classical_streamline_linewidth</span><span class="p">)</span>
<span class="c1">#                           color=self.geodata.roi_array, cmap=&#39;terrain&#39;)</span>

    <span class="k">def</span> <span class="nf">plot_gradient_vector_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_size_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                   <span class="n">vec_color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span><span class="n">vec_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">vec_scale</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Topographic gradient vector field on color shaded relief</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">x_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">y_pixel_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_pixel_size</span><span class="p">,</span>
                                    <span class="n">window_size_factor</span><span class="o">=</span><span class="n">window_size_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_roi_shaded_relief_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> 
                        <span class="n">color_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">streamline_shaded_relief_color_alpha</span><span class="p">,</span>
                        <span class="n">hillshade_alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">streamline_shaded_relief_hillshade_alpha</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_gradient_vector_field_overlay</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">vec_color</span><span class="o">=</span><span class="n">vec_color</span><span class="p">,</span>
                                                <span class="n">vec_alpha</span><span class="o">=</span><span class="n">vec_alpha</span><span class="p">,</span> <span class="n">vec_scale</span><span class="o">=</span><span class="n">vec_scale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="s1">&#39;gradient_vector_field&#39;</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_gradient_vector_field_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span>
                                           <span class="n">vec_color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span><span class="n">vec_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                           <span class="n">vec_scale</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">       Topographic gradient vector field (overlay method)</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_dim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient_vector_scale</span><span class="o">!=</span><span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient_vector_scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">if</span> <span class="n">max_dim</span><span class="o">&gt;</span><span class="mi">40</span><span class="p">:</span>
            <span class="n">decimation_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">max_dim</span><span class="o">//</span><span class="mi">40</span><span class="o">/</span><span class="mf">10.0</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">decimate</span><span class="p">(</span> 
                    <span class="n">decimate</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">uv_array</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">decimation_factor</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> 
                                    <span class="n">decimation_factor</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">decimate</span><span class="p">(</span> 
                    <span class="n">decimate</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">uv_array</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">decimation_factor</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> 
                                <span class="n">decimation_factor</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">decimate</span><span class="p">(</span> 
                    <span class="n">decimate</span><span class="p">(</span>
                        <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">(),</span>
                            <span class="n">decimation_factor</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> 
                                <span class="n">decimation_factor</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">uv_array</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">uv_array</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">merge_active_masks</span><span class="p">()</span>
        <span class="c1"># Normalize for clarity</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">/</span><span class="n">speed</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">/</span><span class="n">speed</span>
        <span class="n">x_roi_n_pixel_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> 
                                          <span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y_roi_n_pixel_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> 
                                          <span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_roi_n_pixel_centers</span><span class="p">,</span><span class="n">y_roi_n_pixel_centers</span><span class="p">),</span> 
                    <span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> 
                    <span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                    <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">vec_color</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">vec_alpha</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">vec_scale</span>
                    <span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">plot_blockages_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blocked zone pixels</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Blocked outflows (narrow diagonal outflows)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">noisy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Blockage @&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">where_blockages_array</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">where_blockages_array</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Unable to plot blockages: no such array&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">where_blockages_array</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">where_blockages_array</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                  <span class="c1"># Blockages plotted as hexagons &#39;H&#39;</span>
                 <span class="s1">&#39;kH&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">blockage_marker_size</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="c1"># Blocked outflow neighbors</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">noisy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Blockage neighbor @&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">where_blocked_neighbors_array</span><span class="p">))</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">where_blocked_neighbors_array</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">where_blocked_neighbors_array</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="c1"># Blockage neighbors plotted as squares &#39;s&#39;</span>
                <span class="n">color</span><span class="o">+</span><span class="n">shape</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">blockage_marker_size</span><span class="p">,</span> 
                <span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
 
    <span class="k">def</span> <span class="nf">plot_loops_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loop zone pixels</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">where_looped_array</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Unable to plot loops: no such array&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">where_looped_array</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="o">.</span><span class="n">where_looped_array</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span>
                    <span class="c1"># Loops plotted as circles &#39;o&#39;</span>
                    <span class="n">color</span><span class="o">+</span><span class="n">shape</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loops_marker_size</span><span class="p">,</span> 
                    <span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_seed_points_overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axes</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Seed points</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_point_marker_size</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="n">marker</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_point_marker</span>   
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_point_marker_size</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed_point_marker_color</span>
        
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">seed_point_array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_x_origin</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">seed_point_array</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">roi_y_origin</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                <span class="n">marker</span><span class="p">,</span> 
                <span class="n">ms</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> 
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seed_point_marker_alpha</span><span class="p">,</span>
                <span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_midslope_elevations_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot distribution of midslope as kernel-smoothed pdf</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;midslope_elevations_pdf&#39;</span>
        <span class="n">window_title</span> <span class="o">=</span> <span class="s1">&#39;midslope_elevations_pdf&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;:  Elevation distribution&#39;</span>  
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

        <span class="n">h_midline_pdf_array</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">h_midline_pdf_array</span>
        <span class="n">h_midline_pdf_max1</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">h_midline_pdf_max1</span>
        <span class="n">h_midline_pdf_max1_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">h_midline_pdf_max1_h</span>
        <span class="n">h_all_pdf_array</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">h_all_pdf_array</span>
        <span class="n">h_array</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">h_array</span>
        <span class="n">sf</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">h_pdf_sf</span>        
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h_midline_pdf_array</span><span class="o">/</span><span class="n">sf</span><span class="p">,</span> <span class="n">h_array</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;midline&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h_midline_pdf_max1</span><span class="o">/</span><span class="n">sf</span><span class="p">,</span> <span class="n">h_midline_pdf_max1_h</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:4}</span><span class="s1">$\,$m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">h_midline_pdf_max1_h</span><span class="p">)))</span>  <span class="p">)</span>
        <span class="c1"># plt.plot(h_midline_pdf_max2/sf, h_midline_pdf_max_h2, &#39;s&#39;, c=&#39;k&#39;, ms=8,</span>
        <span class="c1">#          label=&#39;{:4}$\,$m&#39;.format(np.int(h_midline_pdf_max_h2))  )</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h_all_pdf_array</span><span class="o">/</span><span class="n">sf</span><span class="p">,</span> <span class="n">h_array</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.002</span><span class="p">,)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1">#         plt.title(title)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Elevation $h$  [m]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Density $p(h)$  [rescaled m$^{-1}$]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_slope_angles_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot distribution of slope angles as kernel-smoothed pdf</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span><span class="o">=</span><span class="s1">&#39;slope_angles_pdf&#39;</span>
        <span class="n">window_title</span><span class="o">=</span><span class="s1">&#39;slope_angles_pdf&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geodata</span><span class="o">.</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;:  Midslope angle distribution&#39;</span>   
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        
        <span class="n">slope_midline_pdf_array</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">slope_midline_pdf_array</span>
        <span class="n">slope_midline_pdf_max</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">slope_midline_pdf_max</span>
        <span class="n">slope_midline_pdf_max_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">slope_midline_pdf_max_slope</span>
        <span class="n">slope_array</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">slope_array</span>        
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slope_midline_pdf_array</span><span class="o">/</span><span class="n">slope_midline_pdf_max</span><span class="p">,</span> <span class="n">slope_array</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">slope_midline_pdf_max</span><span class="o">/</span><span class="n">slope_midline_pdf_max</span><span class="p">,</span> 
                 <span class="n">slope_midline_pdf_max_slope</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> 
                 <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;modal slope =</span><span class="si">{:4}</span><span class="s1">$^\circ$&#39;</span>
                 <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">slope_midline_pdf_max_slope</span><span class="p">)))</span>  <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.002</span><span class="p">,)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1">#         plt.title(title)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Slope angle   $</span><span class="se">\\</span><span class="s1">mathrm</span><span class="si">{atan}</span><span class="s1">|</span><span class="se">\\</span><span class="s1">nabla</span><span class="si">{h}</span><span class="s1">|$  [$^{\circ}$]&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Density  $p(</span><span class="se">\\</span><span class="s1">mathrm</span><span class="si">{atan}</span><span class="s1">|</span><span class="se">\\</span><span class="s1">nabla</span><span class="si">{h}</span><span class="s1">|)$  [rescaled 1/$^{\circ}$]&#39;</span><span class="p">)</span>
        <span class="c1"># plt.xlabel(</span>
        <span class="c1">#     &#39;Relative frequency $p(|\\nabla{h}|)$  [rescaled 1/$^{\circ}$]&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">plot_distributions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot probability distributions of processed streamline data.</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Plotting distributions...&#39;</span><span class="p">)</span>

        <span class="c1"># Marginal univariate pdfs</span>
        <span class="n">marginals_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dsla&#39;</span><span class="p">,</span><span class="s1">&#39;usla&#39;</span><span class="p">,</span><span class="s1">&#39;dslt&#39;</span><span class="p">,</span><span class="s1">&#39;uslt&#39;</span><span class="p">,</span><span class="s1">&#39;dslc&#39;</span><span class="p">,</span><span class="s1">&#39;uslc&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">marginal</span> <span class="ow">in</span> <span class="n">marginals_list</span><span class="p">:</span>
            <span class="n">marginal_fn</span> <span class="o">=</span> <span class="s1">&#39;plot_marginal_pdf_&#39;</span><span class="o">+</span><span class="n">marginal</span>
            <span class="n">do_plot</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;do_&#39;</span><span class="o">+</span><span class="n">marginal_fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">do_plot</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">plot_fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">marginal_fn</span><span class="p">)</span>
                    <span class="n">plot_fn</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Failed in &quot;plot_distributions&quot;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>

        <span class="c1"># Joint bivariate pdfs</span>
        <span class="n">joint_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dsla_usla&#39;</span><span class="p">,</span><span class="s1">&#39;usla_uslt&#39;</span><span class="p">,</span><span class="s1">&#39;dsla_dslt&#39;</span><span class="p">,</span><span class="s1">&#39;dslt_dslc&#39;</span><span class="p">,</span><span class="s1">&#39;dslt_dsla&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;uslt_dslt&#39;</span><span class="p">,</span><span class="s1">&#39;usla_uslc&#39;</span><span class="p">,</span><span class="s1">&#39;dsla_dslc&#39;</span><span class="p">,</span><span class="s1">&#39;uslc_dslc&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">joint_list</span><span class="p">:</span>
            <span class="n">joint_fn</span> <span class="o">=</span> <span class="s1">&#39;plot_joint_pdf_&#39;</span><span class="o">+</span><span class="n">joint</span>
            <span class="n">do_plot</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;do_&#39;</span><span class="o">+</span><span class="n">joint_fn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">do_plot</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">plot_fn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">joint_fn</span><span class="p">)</span>
                    <span class="n">plot_fn</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Failed in &quot;plot_distributions&quot;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;...done&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_marginal_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marginal_distbn</span><span class="p">,</span> <span class="n">fig_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">window_title</span><span class="o">=</span><span class="n">fig_name</span>

        <span class="c1"># Get ready</span>
        <span class="n">x_vec</span> <span class="o">=</span> <span class="n">marginal_distbn</span><span class="o">.</span><span class="n">x_vec</span>
        <span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span> <span class="o">=</span> <span class="n">x_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_vec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Generate curves</span>
<span class="c1">#         legend += [&#39;&#39;]</span>
        <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;kde pdf&#39;</span><span class="p">]</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">marginal_distbn</span><span class="o">.</span><span class="n">pdf</span>
        <span class="n">pdf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">pdf</span> <span class="p">]</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="n">pdf_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">pdf_ysf_list</span> <span class="o">=</span> <span class="p">[</span> <span class="n">y_max</span> <span class="p">]</span>
        <span class="n">line_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;crimson&#39;</span><span class="p">]</span>
        <span class="n">line_styles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">]</span>
        <span class="n">line_alphas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;Gaussian&#39;</span><span class="p">]</span>
        <span class="n">loc</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">marginal_distbn</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">marginal_distbn</span><span class="o">.</span><span class="n">stddev</span><span class="p">)</span>
        
        <span class="n">pdf</span>   <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_vec</span><span class="p">),</span><span class="n">loc</span><span class="p">,</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">pdf_max</span> <span class="o">=</span> <span class="n">pdf</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> 
        <span class="n">pdf_ysf_list</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">pdf_max</span> <span class="p">]</span>
        <span class="n">pdf_list</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">y_max</span><span class="o">*</span><span class="n">pdf</span><span class="o">/</span><span class="n">pdf_max</span> <span class="p">]</span>
        <span class="n">line_colors</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;darkmagenta&#39;</span><span class="p">]</span>
        <span class="n">line_styles</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-.&#39;</span><span class="p">]</span>
        <span class="n">line_alphas</span> <span class="o">+=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">]</span>
                                 
        <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;detrended&#39;</span><span class="p">]</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">marginal_distbn</span><span class="o">.</span><span class="n">pdf</span>
        <span class="n">norm_pdf</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_vec</span><span class="p">),</span><span class="n">loc</span><span class="p">,</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">detrended_pdf</span> <span class="o">=</span> <span class="n">pdf</span><span class="o">/</span><span class="n">norm_pdf</span>
<span class="c1">#         detrended_pdf = marginal_distbn.detrended_pdf</span>
        <span class="n">dt_min_idx</span> <span class="o">=</span> <span class="n">marginal_distbn</span><span class="o">.</span><span class="n">mode_i</span><span class="o">//</span><span class="mi">2</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dt_max_idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">*</span><span class="n">marginal_distbn</span><span class="o">.</span><span class="n">mode_i</span><span class="p">,</span>
                              <span class="n">marginal_distbn</span><span class="o">.</span><span class="n">channel_threshold_i</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">dt_max_idx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">marginal_distbn</span><span class="o">.</span><span class="n">mode_i</span><span class="p">,</span><span class="n">detrended_pdf</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">detrended_pdf</span> <span class="o">/=</span> <span class="nb">max</span><span class="p">(</span><span class="n">detrended_pdf</span><span class="p">[</span><span class="n">dt_min_idx</span><span class="p">:</span><span class="n">dt_max_idx</span><span class="p">])</span>
        <span class="n">pdf_max</span> <span class="o">=</span> <span class="n">norm_pdf</span><span class="p">[</span><span class="n">marginal_distbn</span><span class="o">.</span><span class="n">mode_i</span><span class="p">]</span>
        <span class="n">pdf_ysf_list</span> <span class="o">+=</span>  <span class="p">[</span> <span class="n">pdf_max</span> <span class="p">]</span>
        <span class="n">pdf_list</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">y_max</span><span class="o">*</span><span class="n">detrended_pdf</span> <span class="p">]</span>
        <span class="n">line_colors</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;darkblue&#39;</span><span class="p">]</span>
        <span class="n">line_styles</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">]</span>
        <span class="n">line_alphas</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            
        <span class="c1"># Create graph</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        
        <span class="c1"># Do the plotting</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span> <span class="n">pdf_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">line_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">line_alphas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                  <span class="n">linestyle</span><span class="o">=</span><span class="n">line_styles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">line_colors</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">line_alphas</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> 
                  <span class="n">linestyle</span><span class="o">=</span><span class="n">line_styles</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>  <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">pdf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pdf_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span> <span class="n">marginal_distbn</span><span class="o">.</span><span class="n">channel_threshold_x</span>
            <span class="n">y</span><span class="o">=</span> <span class="n">y_max</span><span class="o">*</span><span class="n">detrended_pdf</span><span class="p">[</span><span class="n">marginal_distbn</span><span class="o">.</span><span class="n">channel_threshold_i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> \
                        <span class="o">/</span><span class="n">pdf_max</span>
            <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;thresh=</span><span class="si">{0:2.0f}</span><span class="s1">m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.0</span><span class="o">*</span><span class="n">axes</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]],</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> 
                     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;Cannot plot threshold: none found&#39;</span><span class="p">)</span>
        
        <span class="c1"># Presentation</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
        <span class="n">x_ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_ticks</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">,</span><span class="n">x_ticks</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper right&#39;</span>
<span class="c1">#         loc = &#39;upper left&#39;</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span><span class="n">framealpha</span><span class="o">=</span><span class="mf">0.97</span><span class="p">)</span>

        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">x_max</span><span class="o">*</span><span class="mf">1.001</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="n">y_max</span><span class="o">*</span><span class="mf">1.1</span><span class="p">)</span>

        <span class="c1"># Display &amp; record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>    
        
    <span class="k">def</span> <span class="nf">plot_marginal_pdf_dsla</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;marginal_pdf_dsla&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline length distribution $f(\log(L_</span><span class="si">{md}</span><span class="s1">))$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline mean length  $L_</span><span class="si">{md}</span><span class="s1">$ [meters]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Probability density  $f(\log(L_</span><span class="si">{md}</span><span class="s1">))$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">marginal_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dsla</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_marginal_pdf</span><span class="p">(</span><span class="n">marginal_distbn</span><span class="p">,</span> <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> 
                               <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">plot_marginal_pdf_usla</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;marginal_pdf_usla&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline length distribution $f(\log(L_</span><span class="si">{mu}</span><span class="s1">))$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline mean length  $L_</span><span class="si">{mu}</span><span class="s1">$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Probability density  $f(\log(L_</span><span class="si">{mu}</span><span class="s1">))$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">marginal_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_usla</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_marginal_pdf</span><span class="p">(</span><span class="n">marginal_distbn</span><span class="p">,</span> <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> 
                               <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">plot_marginal_pdf_dslt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;marginal_pdf_dslt&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline root equiv area distribution $f(\log\sqrt{A_</span><span class="si">{ed}</span><span class="s1">})$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline root equiv area  $\sqrt{A_</span><span class="si">{ed}</span><span class="s1">}$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Probability density  $f(\log\sqrt{A_</span><span class="si">{ed}</span><span class="s1">})$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">marginal_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dslt</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_marginal_pdf</span><span class="p">(</span><span class="n">marginal_distbn</span><span class="p">,</span> <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> 
                                      <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">plot_marginal_pdf_uslt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;marginal_pdf_uslt&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline root equiv area distribution $f(\log\sqrt{A_</span><span class="si">{eu}</span><span class="s1">})$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline root equiv area  $\sqrt{A_</span><span class="si">{eu}</span><span class="s1">}$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Probability density  $f(\log\sqrt{A_</span><span class="si">{eu}</span><span class="s1">})$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">marginal_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_uslt</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_marginal_pdf</span><span class="p">(</span><span class="n">marginal_distbn</span><span class="p">,</span> <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> 
                               <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_marginal_pdf_dslc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;marginal_pdf_dslc&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline concentration distribution $f(\log(C_</span><span class="si">{d}</span><span class="s1">))$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline concentration  $C_</span><span class="si">{d}</span><span class="s1">$ [lines/m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Probability density  $f(\log(C_</span><span class="si">{d}</span><span class="s1">))$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">marginal_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dslc</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_marginal_pdf</span><span class="p">(</span><span class="n">marginal_distbn</span><span class="p">,</span> <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> 
                               <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">plot_marginal_pdf_uslc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;marginal_pdf_uslc&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline concentration distribution $f(\log(C_</span><span class="si">{u}</span><span class="s1">))&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline concentration  $C_</span><span class="si">{u}</span><span class="s1">$ [lines/m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Probability density  $f(\log(C_</span><span class="si">{u}</span><span class="s1">))$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">marginal_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_uslc</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_marginal_pdf</span><span class="p">(</span><span class="n">marginal_distbn</span><span class="p">,</span> <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> 
                               <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span><span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_joint_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bivariate_distribution</span><span class="p">,</span> <span class="n">mx_distbn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">my_distbn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">fig_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">swap_xy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_nl_trend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">x_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> 
                       <span class="n">xsym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$L_m^{*}$&#39;</span><span class="p">,</span> <span class="n">ysym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\sqrt{A_e^*}$&#39;</span><span class="p">,</span> 
                       <span class="n">do_plot_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_overlay_histogram</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">          </span>
<span class="sd">        Args:</span>
<span class="sd">            TBD (TBD): </span>
<span class="sd">        </span>
<span class="sd">        TBD</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            TBD: </span>
<span class="sd">            TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">window_title</span><span class="o">=</span><span class="n">fig_name</span>

        <span class="c1"># Preparation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">swap_xy</span><span class="p">:</span>
            <span class="n">x_mesh</span> <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">x_mesh</span>
            <span class="n">y_mesh</span> <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">y_mesh</span>
            <span class="n">x_vec</span>  <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">x_mesh</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_vec</span>  <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">y_mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_mesh</span> <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">y_mesh</span>
            <span class="n">y_mesh</span> <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">x_mesh</span>
            <span class="n">x_vec</span>  <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">y_mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="n">y_vec</span>  <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">x_mesh</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mode_xy</span> <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">mode_xy</span>
        <span class="n">x_min</span> <span class="o">=</span> <span class="n">x_mesh</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="n">x_mesh</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="n">y_mesh</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="n">y_mesh</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        
        <span class="c1"># Create mpl figure</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_figure</span><span class="p">(</span><span class="n">window_title</span><span class="o">=</span><span class="n">window_title</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Pdfs</span>
        <span class="n">kde_pdf</span>      <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">pdf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">swap_xy</span><span class="p">:</span>
            <span class="n">kde_pdf</span>  <span class="o">=</span> <span class="n">kde_pdf</span><span class="o">.</span><span class="n">T</span>
        <span class="n">kde_pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">kde_pdf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">joint_distbn_viz_scale</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">do_overlay_histogram</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="k">import</span> <span class="n">downscale_local_mean</span>
            <span class="n">downscale_factor</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">kde_hist</span>    <span class="o">=</span> <span class="n">downscale_local_mean</span><span class="p">(</span><span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">histogram</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                                               <span class="p">(</span><span class="n">downscale_factor</span><span class="p">,</span><span class="n">downscale_factor</span><span class="p">))</span>
            <span class="n">kde_hist</span><span class="p">[</span><span class="n">kde_hist</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">kde_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">kde_hist</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="n">kde_hist</span><span class="p">)</span>
            <span class="n">n_hist_bins</span> <span class="o">=</span> <span class="n">bivariate_distribution</span><span class="o">.</span><span class="n">n_hist_bins</span>
            <span class="n">x_hist_vec</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_min</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_max</span><span class="p">),</span>
                                             <span class="n">n_hist_bins</span><span class="o">//</span><span class="n">downscale_factor</span><span class="p">))</span>
            <span class="n">y_hist_vec</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_min</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_max</span><span class="p">),</span>
                                             <span class="n">n_hist_bins</span><span class="o">//</span><span class="n">downscale_factor</span><span class="p">))</span>        
            <span class="k">if</span> <span class="n">swap_xy</span><span class="p">:</span>
                <span class="n">kde_hist</span> <span class="o">=</span> <span class="n">kde_hist</span><span class="o">.</span><span class="n">T</span>
        
        <span class="c1"># Plot bivariate pdf - distorted for emphasis as appropriate</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span><span class="n">y_vec</span><span class="p">,</span><span class="n">kde_pdf</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;GnBu&#39;</span><span class="p">,</span> 
                        <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">&#39;gouraud&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_overlay_histogram</span><span class="p">:</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x_hist_vec</span><span class="p">,</span><span class="n">y_hist_vec</span><span class="p">,</span><span class="n">kde_hist</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> 
                            <span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span><span class="n">y_vec</span><span class="p">,</span> <span class="n">kde_pdf</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_distbn_n_contours</span><span class="p">,</span>
                     <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Plot thresholds</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;threshold &#39;</span><span class="o">+</span><span class="n">xsym_label</span>
                       <span class="o">+</span><span class="s1">&#39; = </span><span class="si">{:.0f}</span><span class="s1">m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
                        <span class="n">mx_distbn</span><span class="o">.</span><span class="n">channel_threshold_x</span><span class="p">,</span><span class="mi">0</span><span class="p">))]</span>
            <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;threshold &#39;</span><span class="o">+</span><span class="n">ysym_label</span>
                       <span class="o">+</span><span class="s1">&#39; = </span><span class="si">{:.0f}</span><span class="s1">m&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span>
                        <span class="n">my_distbn</span><span class="o">.</span><span class="n">channel_threshold_x</span><span class="p">,</span><span class="mi">0</span><span class="p">))]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">swap_xy</span><span class="p">:</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vec</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="n">mx_distbn</span><span class="o">.</span><span class="n">channel_threshold_x</span><span class="p">,</span><span class="n">y_vec</span><span class="p">,</span>
                          <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span><span class="n">y_vec</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="n">my_distbn</span><span class="o">.</span><span class="n">channel_threshold_x</span><span class="p">,</span>
                          <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
<span class="c1">#                 pdebug(&#39;swapping xy&#39;)</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vec</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="n">mx_distbn</span><span class="o">.</span><span class="n">channel_threshold_x</span><span class="p">,</span><span class="n">y_vec</span><span class="p">,</span>
                          <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vec</span><span class="p">,</span><span class="n">y_vec</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="n">my_distbn</span><span class="o">.</span><span class="n">channel_threshold_x</span><span class="p">,</span>
                          <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="n">do_extras</span> <span class="o">=</span> <span class="kc">True</span>  
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Problem with channel threshold&#39;</span><span class="p">)</span>
            <span class="n">do_extras</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">do_extras</span><span class="p">:</span>
            <span class="c1"># Plot cross @ hillslope mode</span>
            <span class="n">cross_alpha</span><span class="o">=</span><span class="mf">0.6</span>
            <span class="n">mode_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">swap_xy</span><span class="p">:</span>
                <span class="n">mode_xy</span> <span class="o">=</span> <span class="n">mode_xy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mode_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">mode_xy</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">do_plot_mode</span><span class="p">:</span>
                <span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">mxc</span><span class="p">,</span><span class="n">msx</span><span class="p">,</span><span class="n">mewx</span><span class="p">,</span><span class="n">mi</span><span class="p">,</span><span class="n">msi</span><span class="p">,</span><span class="n">mewi</span><span class="p">,</span><span class="n">mc</span><span class="p">,</span><span class="n">msc</span><span class="p">,</span><span class="n">ma</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_distbn_markers</span>
                <span class="k">if</span> <span class="n">mode_xy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;_no_legend_&#39;</span><span class="p">]</span>
                    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mode_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mode_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">mi</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">msx</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="n">mewx</span><span class="p">)</span>
                    <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;hillslope mode&#39;</span><span class="p">]</span>
                    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mode_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mode_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">mx</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">mxc</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="n">msi</span><span class="p">,</span><span class="n">mew</span><span class="o">=</span><span class="n">mewi</span><span class="p">)</span>
                     
            <span class="c1"># Linear trend x=y</span>
    <span class="c1">#         h_grad = mode_xy[1]/mode_xy[0]</span>
            <span class="n">h_grad</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">swap_xy</span><span class="p">:</span>
                <span class="n">h_grad_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:1.1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h_grad</span><span class="p">)</span>
                <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;hillslope  $y =$&#39;</span><span class="o">+</span><span class="s1">&#39;$x$&#39;</span><span class="p">]</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x_vec</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">h_grad_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:0.2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h_grad</span><span class="p">)</span>
                <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;hillslope  $y =$&#39;</span><span class="o">+</span><span class="s1">&#39;$x$&#39;</span><span class="p">]</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x_vec</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">*</span><span class="n">h_grad</span><span class="p">,</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    
            <span class="c1"># Nonlinear trend y=x^n</span>
            <span class="k">if</span> <span class="n">do_nl_trend</span><span class="p">:</span>
                <span class="n">h_grad</span> <span class="o">=</span> <span class="n">mode_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">mode_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">h_grad</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">swap_xy</span><span class="p">:</span>
                    <span class="n">h_grad_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:1.1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h_grad</span><span class="p">)</span>
                    <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;channel  $y =$&#39;</span><span class="o">+</span><span class="s1">&#39;$x^{3/2}$&#39;</span><span class="p">]</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x_vec</span>
                    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> 
                              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">h_grad_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:0.2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h_grad</span><span class="p">)</span>
                    <span class="n">legend</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;channel  $y =$&#39;</span><span class="o">+</span><span class="s1">&#39;${x^{1/3}$&#39;</span><span class="p">]</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x_vec</span>
                    <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">2.0</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="c1">#np.power(1.5,0.5)*</span>
                              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

        <span class="c1"># Presentation</span>
<span class="c1">#         loc = &#39;lower right&#39;</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">framealpha</span><span class="o">=</span><span class="mf">0.97</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">numticks</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">numticks</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>
        <span class="n">x_ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_ticks</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">)</span>
        <span class="n">y_ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_choose_ticks</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span><span class="n">y_max</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">,</span><span class="n">x_ticks</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">y_ticks</span><span class="p">,</span><span class="n">y_ticks</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.999</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="n">x_max</span><span class="o">*</span><span class="mf">1.001</span><span class="p">)</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="n">y_min</span><span class="o">*</span><span class="mf">0.999</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="n">y_max</span><span class="o">*</span><span class="mf">1.001</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;x,y min,max not provided&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
        
        <span class="c1"># Push to screen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_joint_pdf_dsla_usla</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;joint_pdf_dsla_usla&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Streamline length distribution$ f(L_</span><span class="si">{md}</span><span class="s1">,L_</span><span class="si">{mu}</span><span class="s1">)$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline mean length  $L_</span><span class="si">{md}</span><span class="s1">$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline mean length  $L_</span><span class="si">{mu}</span><span class="s1">$ [m]&#39;</span>
        <span class="n">xsym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$L_</span><span class="si">{md}</span><span class="s1">^{*}$&#39;</span>
        <span class="n">ysym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$L_</span><span class="si">{mu}</span><span class="s1">^{*}$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">joint_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">jpdf_dsla_usla</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mx_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dsla</span>
            <span class="n">my_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_usla</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">mx_distbn</span>    <span class="o">=</span> <span class="kc">None</span>
            <span class="n">my_distbn</span>    <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_joint_pdf</span><span class="p">(</span><span class="n">joint_distbn</span><span class="p">,</span> <span class="n">mx_distbn</span><span class="o">=</span><span class="n">mx_distbn</span><span class="p">,</span> <span class="n">my_distbn</span><span class="o">=</span><span class="n">my_distbn</span><span class="p">,</span>
                            <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> 
                            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span>
                            <span class="n">xsym_label</span><span class="o">=</span><span class="n">xsym_label</span><span class="p">,</span> <span class="n">ysym_label</span><span class="o">=</span><span class="n">ysym_label</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">plot_joint_pdf_usla_uslt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;joint_pdf_usla_uslt&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline length distribution $f(\log(L_</span><span class="si">{mu}</span><span class="s1">),\log\sqrt{A_</span><span class="si">{eu}</span><span class="s1">})$ &#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline mean length  $L_</span><span class="si">{mu}</span><span class="s1">$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline root equiv area  $\sqrt{A_</span><span class="si">{eu}</span><span class="s1">}$ [m]&#39;</span>
        <span class="n">xsym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$L_</span><span class="si">{mu}</span><span class="s1">^{*}$&#39;</span>
        <span class="n">ysym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\sqrt{A_</span><span class="si">{eu}</span><span class="s1">^*}$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">joint_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">jpdf_usla_uslt</span>
            <span class="n">mx_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_usla</span>
            <span class="n">my_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_uslt</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_joint_pdf</span><span class="p">(</span><span class="n">joint_distbn</span><span class="p">,</span> <span class="n">mx_distbn</span><span class="o">=</span><span class="n">mx_distbn</span><span class="p">,</span> <span class="n">my_distbn</span><span class="o">=</span><span class="n">my_distbn</span><span class="p">,</span>
                            <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> <span class="n">do_nl_trend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span>
                            <span class="n">xsym_label</span><span class="o">=</span><span class="n">xsym_label</span><span class="p">,</span> <span class="n">ysym_label</span><span class="o">=</span><span class="n">ysym_label</span><span class="p">,</span>
                            <span class="n">do_plot_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_joint_pdf_dsla_dslt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;joint_pdf_dsla_dslt&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline length distribution $f(\log(L_</span><span class="si">{md}</span><span class="s1">),\log\sqrt{A_</span><span class="si">{ed}</span><span class="s1">})$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline mean length  $L_</span><span class="si">{md}</span><span class="s1">$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline root equiv area  $\sqrt{A_</span><span class="si">{ed}</span><span class="s1">}$ [m]&#39;</span>
        <span class="n">xsym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$L_</span><span class="si">{md}</span><span class="s1">^{*}$&#39;</span>
        <span class="n">ysym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\sqrt{A_</span><span class="si">{ed}</span><span class="s1">^*}$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">joint_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">jpdf_dsla_dslt</span>
            <span class="n">mx_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dsla</span>
            <span class="n">my_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dslt</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_joint_pdf</span><span class="p">(</span><span class="n">joint_distbn</span><span class="p">,</span> <span class="n">mx_distbn</span><span class="o">=</span><span class="n">mx_distbn</span><span class="p">,</span> <span class="n">my_distbn</span><span class="o">=</span><span class="n">my_distbn</span><span class="p">,</span>
                            <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> <span class="n">swap_xy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_nl_trend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span>
                            <span class="n">xsym_label</span><span class="o">=</span><span class="n">xsym_label</span><span class="p">,</span> <span class="n">ysym_label</span><span class="o">=</span><span class="n">ysym_label</span><span class="p">,</span>
                            <span class="n">do_plot_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_joint_pdf_dslt_dsla</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;joint_pdf_dslt_dsla&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline length distribution $f(\log\sqrt{A_</span><span class="si">{ed}</span><span class="s1">},\log(L_</span><span class="si">{md}</span><span class="s1">))$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline root equiv area  $\sqrt{A_</span><span class="si">{ed}</span><span class="s1">}$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline mean length  $L_</span><span class="si">{md}</span><span class="s1">$ [m]&#39;</span>
        <span class="n">xsym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\sqrt{A_</span><span class="si">{ed}</span><span class="s1">^*}$&#39;</span>
        <span class="n">ysym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$L_</span><span class="si">{md}</span><span class="s1">^{*}$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">joint_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">jpdf_dsla_dslt</span>
            <span class="n">mx_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dsla</span>
            <span class="n">my_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dslt</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_joint_pdf</span><span class="p">(</span><span class="n">joint_distbn</span><span class="p">,</span> <span class="n">mx_distbn</span><span class="o">=</span><span class="n">mx_distbn</span><span class="p">,</span> <span class="n">my_distbn</span><span class="o">=</span><span class="n">my_distbn</span><span class="p">,</span>
                            <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> <span class="n">swap_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span>
                            <span class="n">xsym_label</span><span class="o">=</span><span class="n">xsym_label</span><span class="p">,</span> <span class="n">ysym_label</span><span class="o">=</span><span class="n">ysym_label</span><span class="p">,</span>
                            <span class="n">do_plot_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_joint_pdf_uslt_dslt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;joint_pdf_uslt_dslt&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Streamline root equiv area distribution $f\sqrt{A_</span><span class="si">{eu}</span><span class="s1">},\sqrt{A_</span><span class="si">{ed}</span><span class="s1">}$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline root equiv area  $\sqrt{A_</span><span class="si">{eu}</span><span class="s1">}$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline root equiv area  $\sqrt{A_</span><span class="si">{ed}</span><span class="s1">}$ [m]&#39;</span>
        <span class="n">xsym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\sqrt{A_</span><span class="si">{eu}</span><span class="s1">^*}$&#39;</span>
        <span class="n">ysym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\sqrt{A_</span><span class="si">{ed}</span><span class="s1">^*}$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">joint_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">jpdf_uslt_dslt</span>
            <span class="n">mx_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_uslt</span>
            <span class="n">my_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dslt</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_joint_pdf</span><span class="p">(</span><span class="n">joint_distbn</span><span class="p">,</span> <span class="n">mx_distbn</span><span class="o">=</span><span class="n">mx_distbn</span><span class="p">,</span> <span class="n">my_distbn</span><span class="o">=</span><span class="n">my_distbn</span><span class="p">,</span>
                            <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span>
                            <span class="n">xsym_label</span><span class="o">=</span><span class="n">xsym_label</span><span class="p">,</span> <span class="n">ysym_label</span><span class="o">=</span><span class="n">ysym_label</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_joint_pdf_usla_uslc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;joint_pdf_usla_uslc&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline distribution $f(\log(L_</span><span class="si">{mu}</span><span class="s1">),\log(C_</span><span class="si">{u}</span><span class="s1">))$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline mean length  $L_</span><span class="si">{mu}</span><span class="s1">$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline concentration  $C_</span><span class="si">{u}</span><span class="s1">$ [lines/m]&#39;</span>
        <span class="n">xsym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$L_</span><span class="si">{mu}</span><span class="s1">^{*}$&#39;</span>
        <span class="n">ysym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$C_</span><span class="si">{u}</span><span class="s1">^*$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">joint_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">jpdf_usla_uslc</span>
            <span class="n">mx_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_usla</span>
            <span class="n">my_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_uslc</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_joint_pdf</span><span class="p">(</span><span class="n">joint_distbn</span><span class="p">,</span> <span class="n">mx_distbn</span><span class="o">=</span><span class="n">mx_distbn</span><span class="p">,</span> <span class="n">my_distbn</span><span class="o">=</span><span class="n">my_distbn</span><span class="p">,</span>
                            <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> <span class="n">do_nl_trend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span>
                            <span class="n">xsym_label</span><span class="o">=</span><span class="n">xsym_label</span><span class="p">,</span> <span class="n">ysym_label</span><span class="o">=</span><span class="n">ysym_label</span><span class="p">,</span>
                            <span class="n">do_plot_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_joint_pdf_dsla_dslc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;joint_pdf_dsla_dslc&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline distribution $f(\log(L_</span><span class="si">{md}</span><span class="s1">),\log(C_</span><span class="si">{d}</span><span class="s1">))$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline mean length  $L_</span><span class="si">{md}</span><span class="s1">$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline concentration  $C_</span><span class="si">{d}</span><span class="s1">$ [lines/m]&#39;</span>
        <span class="n">xsym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$L_</span><span class="si">{md}</span><span class="s1">^{*}$&#39;</span>
        <span class="n">ysym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$C_</span><span class="si">{d}</span><span class="s1">^*$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">joint_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">jpdf_dsla_dslc</span>
            <span class="n">mx_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dsla</span>
            <span class="n">my_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dslc</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_joint_pdf</span><span class="p">(</span><span class="n">joint_distbn</span><span class="p">,</span> <span class="n">mx_distbn</span><span class="o">=</span><span class="n">mx_distbn</span><span class="p">,</span> <span class="n">my_distbn</span><span class="o">=</span><span class="n">my_distbn</span><span class="p">,</span>
                            <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span> <span class="n">do_nl_trend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span>
                            <span class="n">xsym_label</span><span class="o">=</span><span class="n">xsym_label</span><span class="p">,</span> <span class="n">ysym_label</span><span class="o">=</span><span class="n">ysym_label</span><span class="p">,</span>
                            <span class="n">do_plot_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_joint_pdf_dslt_dslc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;joint_pdf_dslt_dslc&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline distribution $f(\sqrt{A_</span><span class="si">{ed}</span><span class="s1">},\log(C_</span><span class="si">{d}</span><span class="s1">))$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline root equiv area  $\sqrt{A_</span><span class="si">{ed}</span><span class="s1">}$ [m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline concentration  $C_</span><span class="si">{d}</span><span class="s1">$ [lines/m]&#39;</span>
        <span class="n">xsym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\sqrt{A_</span><span class="si">{ed}</span><span class="s1">^*}$&#39;</span>
        <span class="n">ysym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$C_</span><span class="si">{d}</span><span class="s1">^*$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">joint_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">jpdf_dslt_dslc</span>
            <span class="n">mx_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dslt</span>
            <span class="n">my_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dslc</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_joint_pdf</span><span class="p">(</span><span class="n">joint_distbn</span><span class="p">,</span> <span class="n">mx_distbn</span><span class="o">=</span><span class="n">mx_distbn</span><span class="p">,</span> <span class="n">my_distbn</span><span class="o">=</span><span class="n">my_distbn</span><span class="p">,</span>
                            <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span>
                            <span class="n">xsym_label</span><span class="o">=</span><span class="n">xsym_label</span><span class="p">,</span> <span class="n">ysym_label</span><span class="o">=</span><span class="n">ysym_label</span><span class="p">,</span>
                            <span class="n">do_plot_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot_joint_pdf_uslc_dslc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TBD</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig_name</span> <span class="o">=</span> <span class="s1">&#39;joint_pdf_uslc_dslc&#39;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Streamline concentration distribution $f(\log(C_</span><span class="si">{u}</span><span class="s1">),\log(C_</span><span class="si">{d}</span><span class="s1">))$&#39;</span>
        <span class="n">x_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Upstreamline concentration  $C_</span><span class="si">{u}</span><span class="s1">$ [lines/m]&#39;</span>
        <span class="n">y_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Downstreamline concentration  $C_</span><span class="si">{d}</span><span class="s1">$ [lines/m]&#39;</span>
        <span class="n">xsym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$C_</span><span class="si">{u}</span><span class="s1">^*$&#39;</span>
        <span class="n">ysym_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$C_</span><span class="si">{d}</span><span class="s1">^*$&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">joint_distbn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">jpdf_uslc_dslc</span>
            <span class="n">mx_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_uslc</span>
            <span class="n">my_distbn</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">mpdf_dslc</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">&#39;&quot; not computed: cannot plot&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_joint_pdf</span><span class="p">(</span><span class="n">joint_distbn</span><span class="p">,</span> <span class="n">mx_distbn</span><span class="o">=</span><span class="n">mx_distbn</span><span class="p">,</span> <span class="n">my_distbn</span><span class="o">=</span><span class="n">my_distbn</span><span class="p">,</span>
                            <span class="n">fig_name</span><span class="o">=</span><span class="n">fig_name</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="n">x_label</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="n">y_label</span><span class="p">,</span>
                            <span class="n">xsym_label</span><span class="o">=</span><span class="n">xsym_label</span><span class="p">,</span> <span class="n">ysym_label</span><span class="o">=</span><span class="n">ysym_label</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_choose_ticks</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">):</span>
        <span class="n">xtick_range</span><span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_min</span><span class="p">))),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_max</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> 
        <span class="n">xtick_range3</span><span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_min</span><span class="p">))),</span>
                       <span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_max</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span> 
        <span class="n">x_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="o">**</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">xtick_range</span><span class="p">,</span><span class="mi">1</span><span class="p">))]</span> \
                <span class="o">+</span> <span class="p">[(</span> <span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">))</span>
                     <span class="k">if</span> <span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">))</span> <span class="p">)</span>
                                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">xtick_range3</span><span class="p">,</span><span class="mi">1</span><span class="p">))]</span> 
<span class="c1">#                 + [( float(str(10**x).replace(&#39;1&#39;,&#39;6&#39;))</span>
<span class="c1">#                      if x&lt;0 else int(str(10**x).replace(&#39;1&#39;,&#39;6&#39;)) )</span>
<span class="c1">#                                             for x in list(range(*xtick_range,1))]</span>
        <span class="n">x_ticks</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">x_ticks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_display</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_fig</span><span class="p">(</span><span class="n">fig_name</span><span class="p">,</span><span class="n">fig</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/../_images/icon3.png" alt="Logo"/>
    
    <h1 class="logo logo-name">Streamlines</h1>
    
  </a>
</p>



<p class="blurb">Topographic streamline mapping of landscape structure</p>







<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <br>
  <p class="biglink"><a class="biglink" href="../py-modindex.html">
         Module Index</a>
  <br><br>
  <h3><a href="../index.html">Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">plot.py</span></code></a><ul>
<li><a class="reference internal" href="#code">Code</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related</h3>
<ul>
  <li><a href="../index.html"></a><ul>
      <li><a href="mapping.html" title="previous chapter"><code class="docutils literal notranslate"><span class="pre">mapping.py</span></code></a></li>
      <li><a href="save.html" title="next chapter"><code class="docutils literal notranslate"><span class="pre">save.py</span></code></a></li>
  </ul></li>
</ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, CPS.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/modules/plot.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>